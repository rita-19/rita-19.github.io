<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Programï½œç‹è€…å®Œæ•´ç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:"Microsoft JhengHei","å¾®è»Ÿæ­£é»‘é«”",sans-serif;
  font-size:18px;
  background:linear-gradient(#ffe6f7,#d6e8ff);
  text-align:center;
  transition:.3s;
}
body.dark{
  background:linear-gradient(160deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.btn{
  padding:10px 16px;
  border:none;
  border-radius:14px;
  background:#ffb8d1;
  cursor:pointer;
  margin:5px;
}
body.dark .btn{background:#444;color:#fff}
.card{
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin:15px;
  display:inline-block;
  width:280px;
}
body.dark .card{background:rgba(255,255,255,.1)}
.section{display:none}

/* ğŸ¥ å°é› */
@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}
.chick-container{
  font-size:80px;
  animation:float 3s infinite;
}
body.dark .chick-container{filter:drop-shadow(0 0 18px gold)}
.chick-container.brave{filter:drop-shadow(0 0 20px gold)}
.chick-container.calm{filter:drop-shadow(0 0 20px #6cf)}
.chick-container.cute{filter:drop-shadow(0 0 20px pink)}
</style>
</head>

<body>

<h1>ğŸ¥ Study Program</h1>

<div>
  <button class="btn" onclick="UI.show('home')">é¦–é </button>
  <button class="btn" onclick="UI.show('pomodoro')">ç•ªèŒ„é˜</button>
  <button class="btn" onclick="UI.show('quiz')">å°æ¸¬é©—</button>
  <button class="btn" onclick="UI.show('chart')">åœ–è¡¨</button>
  <button class="btn" onclick="UI.show('leaderboard')">æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="UI.toggleDark()">ğŸŒ™</button>
</div>

<!-- é¦–é  -->
<section id="home" class="section" style="display:block">
  <div class="chick-container" id="chick">ğŸ¥</div>
  <div class="card"><h3>ç­‰ç´š</h3><p id="levelText">Lv.1</p></div>
  <div class="card"><h3>ä»Šæ—¥è®€æ›¸</h3><p id="todayTime">0 å°æ™‚</p></div>
  <div class="card"><h3>å°é›æ€§æ ¼</h3><p id="chickText">å°šæœªæ¸¬é©—</p></div>
</section>

<!-- ç•ªèŒ„é˜ -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div id="timer" style="font-size:40px">25:00</div>
  <button class="btn" onclick="Pomodoro.start()">é–‹å§‹</button>
  <button class="btn" onclick="Pomodoro.pause()">æš«åœ</button>
  <button class="btn" onclick="Pomodoro.reset()">é‡è¨­</button>
</section>

<!-- æ¸¬é©— -->
<section id="quiz" class="section">
  <div class="card">
    <p id="quizQ"></p>
    <div id="quizOpt"></div>
  </div>
</section>

<!-- åœ–è¡¨ -->
<section id="chart" class="section">
  <canvas id="studyChart" width="300"></canvas>
</section>

<!-- æ’è¡Œæ¦œ -->
<section id="leaderboard" class="section">
  <div class="card">
    <h3>ç™»å…¥</h3>
    <input id="playerName" placeholder="åå­—">
    <button class="btn" onclick="Player.login()">ç™»å…¥</button>

    <p>åˆ†äº«ç¢¼ï¼š<strong id="myCode">---</strong></p>

    <hr>
    <input id="searchCode" placeholder="è¼¸å…¥åˆ†äº«ç¢¼">
    <button class="btn" onclick="Player.search()">æŸ¥è©¢</button>
    <p id="searchResult"></p>

    <hr>
    <ul id="rank"></ul>
  </div>
</section>

<script>
/* ===== ç‹€æ…‹ ===== */
const State={
  level:1,exp:0,
  study:[0,0,0,0,0,0,0],
  chick:"",
  dark:false,
  players:{},
  current:null
};

/* ===== å­˜æª” ===== */
function save(){localStorage.setItem("study",JSON.stringify(State))}
function load(){const d=localStorage.getItem("study");if(d)Object.assign(State,JSON.parse(d))}

/* ===== UI ===== */
const UI={
  show(id){
    document.querySelectorAll(".section").forEach(s=>s.style.display="none");
    document.getElementById(id).style.display="block";
  },
  toggleDark(){
    State.dark=!State.dark;
    document.body.classList.toggle("dark",State.dark);
    save();
  },
  update(){
    levelText.textContent="Lv."+State.level;
    todayTime.textContent=State.study[new Date().getDay()||6]+" å°æ™‚";
    chickText.textContent=State.chick||"å°šæœªæ¸¬é©—";
    chick.className="chick-container "+(State.chick==="å‹‡æ•¢"?"brave":State.chick==="å†·éœ"?"calm":State.chick==="å‘†èŒ"?"cute":"");
    Player.updateUI();
  }
};

/* ===== ç•ªèŒ„é˜ ===== */
const Pomodoro={
  time:1500,timer:null,
  start(){
    if(this.timer)return;
    this.timer=setInterval(()=>{
      this.time--;
      this.render();
      if(this.time<=0){this.finish()}
    },1000)
  },
  pause(){clearInterval(this.timer);this.timer=null},
  reset(){this.pause();this.time=1500;this.render()},
  finish(){
    this.pause();
    this.time=1500;
    State.study[new Date().getDay()||6]+=0.5;
    addExp(20);
    alert("ğŸ… å®Œæˆï¼");
  },
  render(){
    timer.textContent=Math.floor(this.time/60)+":"+String(this.time%60).padStart(2,"0");
  }
};

/* ===== å‡ç´š ===== */
function addExp(v){
  State.exp+=v;
  if(State.exp>=State.level*50){
    State.exp=0;State.level++;
    alert("â¬†ï¸ å‡ç´š Lv."+State.level);
  }
  UI.update();save();
}

/* ===== æ¸¬é©— ===== */
const Quiz={
  i:0,
  q:[
    ["ä½ åƒå“ªéš»å°é›ï¼Ÿ",["å‹‡æ•¢","å†·éœ","å‘†èŒ"]],
    ["é‡åˆ°å›°é›£ä½ æœƒï¼Ÿ",["å‹‡æ•¢","å†·éœ","å‘†èŒ"]]
  ],
  show(){
    quizQ.textContent=this.q[this.i][0];
    quizOpt.innerHTML="";
    this.q[this.i][1].forEach(a=>{
      const b=document.createElement("button");
      b.className="btn";
      b.textContent=a;
      b.onclick=()=>{State.chick=a;this.i++;this.i<this.q.length?this.show():this.finish()};
      quizOpt.appendChild(b);
    })
  },
  finish(){
    addExp(30);
    alert("ğŸ¥ æ¸¬é©—å®Œæˆï¼");
    UI.update();save();
  }
};

/* ===== ç©å®¶ ===== */
const Player={
  login(){
    const n=playerName.value.trim();
    if(!n)return;
    if(!State.players[n]){
      State.players[n]={level:State.level,code:Math.random().toString(36).slice(2,8)};
    }
    State.current=n;
    save();this.updateUI();this.updateRank();
  },
  updateUI(){
    myCode.textContent=State.current?State.players[State.current].code:"---";
  },
  search(){
    const c=searchCode.value;
    for(let n in State.players){
      if(State.players[n].code===c){
        searchResult.textContent=`æ‰¾åˆ° ${n} Lv.${State.players[n].level}`;
        return;
      }
    }
    searchResult.textContent="æ‰¾ä¸åˆ°";
  },
  updateRank(){
    rank.innerHTML="";
    Object.entries(State.players).forEach(([n,d])=>{
      const li=document.createElement("li");
      li.textContent=`${n} Lv.${d.level}`;
      if(n===State.current)li.style.fontWeight="bold";
      rank.appendChild(li);
    })
  }
};

/* ===== åœ–è¡¨ ===== */
const chart=new Chart(studyChart,{
  type:"line",
  data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{data:State.study}]}
});

/* ===== å•Ÿå‹• ===== */
load();UI.update();Quiz.show();Pomodoro.render();
</script>

</body>
</html>
