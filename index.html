<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Galaxy RPG å°é›å†’éšªç‰ˆ</title>
<style>
body {margin:0;padding:0;font-family:"Microsoft JhengHei",sans-serif;background: linear-gradient(#ffe6f7,#d6e8ff);text-align:center;color:#000;transition:0.5s;}
.btn{padding:10px 15px;margin:5px;border:none;border-radius:12px;background:#ffb8d1;font-size:16px;cursor:pointer;transition:0.3s;}
.btn:hover{background:#ff95be;transform:scale(1.05);}
.card{display:inline-block;background:white;padding:20px;margin:15px;border-radius:20px;box-shadow:0 4px 12px rgba(0,0,0,0.15);width:280px;transition:0.3s;}
.card:hover{transform:scale(1.05);}
.level-bar{width:80%; height:20px;background:#fff;border-radius:10px;margin:10px auto;overflow:hidden;box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);}
.level-progress{height:100%;background: linear-gradient(90deg,#ff95be,#ffb8d1);width:0%;transition: width 0.5s;}
.chick-container{width:200px;margin:15px auto;transition: all 0.5s;}
.chick-svg{width:100%;height:auto;}
.chick-glow{filter: drop-shadow(0 0 20px yellow); transform: scale(1.2);}
.section{display:none;}
.chat-input{width:70%; padding:8px; border-radius:10px; border:1px solid #ccc; margin-right:5px;}
input{padding:8px;border-radius:10px;border:1px solid #ccc;margin:5px;}
</style>
</head>
<body>

<h1>ğŸŒŸ Study Galaxy â€“ RPG å°é›å†’éšªç‰ˆ</h1>
<p>å°é›åŠ©æ•™é™ªä½ å­¸ç¿’å†’éšªï¼</p>

<div>
  <button class="btn" onclick="showSection('home')">ğŸ  é¦–é </button>
  <button class="btn" onclick="showSection('pomodoro')">ğŸ… ç•ªèŒ„é˜</button>
  <button class="btn" onclick="showSection('quiz')">ğŸ® å°æ¸¬é©—</button>
  <button class="btn" onclick="showSection('rank')">ğŸ† æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="showSection('achieve')">ğŸ– æˆå°±</button>
  <button class="btn" onclick="toggleMode()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
</div>

<hr style="opacity:0.3; width:80%; margin:20px auto;">

<!-- é¦–é  -->
<section id="home" class="section" style="display:block;">
  <div class="card">
    <h2>ä»Šæ—¥è®€æ›¸æ™‚é–“</h2>
    <p id="todayTime">0 å°æ™‚</p>
  </div>
  <div class="card">
    <h2>å‡ç´šé€²åº¦</h2>
    <div class="level-bar"><div id="levelProgress" class="level-progress"></div></div>
    <p id="levelText">Lv.1 å†’éšªæ–°æ‰‹</p>
  </div>
  <div class="chick-container" id="chickContainer">
    <svg class="chick-svg" viewBox="0 0 200 200"></svg>
  </div>
</section>

<!-- ç•ªèŒ„é˜ -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div style="font-size:48px; margin:20px;" id="timerDisplay">25:00</div>
  <button class="btn" onclick="startTimer()">â–¶ é–‹å§‹</button>
  <button class="btn" onclick="resetTimer()">ğŸ”„ é‡è¨­</button>
</section>

<!-- å°æ¸¬é©— -->
<section id="quiz" class="section">
  <h2>ğŸ® RPG å°é›å°æ¸¬é©—</h2>
  <div class="card" style="max-width:400px; margin:auto;">
    <p id="quizQuestion">Loading...</p>
    <div id="quizOptions"></div>
    <h3 id="quizResult" style="margin-top:20px;"></h3>
  </div>
</section>

<!-- æ’è¡Œæ¦œ -->
<section id="rank" class="section">
  <h2>ğŸ† æœ¬åœ°æ’è¡Œæ¦œ</h2>
  <div class="card" id="leaderboardCard"></div>
  <button class="btn" onclick="generateShareCode()">ç”Ÿæˆåˆ†äº«ç¢¼</button>
  <input id="importCode" placeholder="è¼¸å…¥åˆ†äº«ç¢¼å°å…¥åˆ†æ•¸">
  <button class="btn" onclick="importShareCode()">å°å…¥åˆ†æ•¸</button>
</section>

<!-- æˆå°± -->
<section id="achieve" class="section">
  <h2>ğŸ– æˆå°±ç³»çµ±</h2>
  <div class="card" id="achieveCard"></div>
</section>

<script>
/* -------- åˆ‡æ›å€å¡Š & æ·±è‰²æ¨¡å¼ -------- */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}
let darkMode=false;
function toggleMode(){
  darkMode = !darkMode;
  if(darkMode){
    document.body.style.background = "linear-gradient(#1c1c1c,#333)";
    document.body.style.color = "#fff";
    document.querySelectorAll(".card").forEach(c=>{
      c.style.background = "#222";
      c.style.color = "#fff";
    });
  } else {
    document.body.style.background = "linear-gradient(#ffe6f7,#d6e8ff)";
    document.body.style.color = "#000";
    document.querySelectorAll(".card").forEach(c=>{
      c.style.background = "white";
      c.style.color = "#000";
    });
  }
}

/* -------- ç©å®¶è³‡æ–™ -------- */
let player=JSON.parse(localStorage.getItem("player"))||{level:1,exp:0,score:0,achieve:[],todayTime:0};
let achievements=[
  {id:1,name:"é¦–æ¬¡å‡ç´š",desc:"å‡åˆ° Lv.2",done:false},
  {id:2,name:"å°é›å¤§å¸«",desc:"å‡åˆ° Lv.5",done:false},
  {id:3,name:"è®€æ›¸é”äºº",desc:"ä»Šæ—¥è®€æ›¸ >=1å°æ™‚",done:false}
];

function savePlayer(){localStorage.setItem("player",JSON.stringify(player));}
function addEXP(amount){
  player.exp+=amount;
  player.score+=amount;
  checkLevelUp();
  savePlayer();
  updateUI();
}
function checkLevelUp(){
  let needed=player.level*50;
  while(player.exp>=needed){
    player.exp-=needed;
    player.level++;
    playAudio('levelup');
    checkAchievements();
    chickLevelUp();
    needed=player.level*50;
  }
}
function updateUI(){
  let percent=(player.exp/(player.level*50))*100;
  document.getElementById("levelProgress").style.width=percent+"%";
  document.getElementById("levelText").textContent="Lv."+player.level+" å†’éšªè€…";
  document.getElementById("todayTime").textContent=player.todayTime+" å°æ™‚";
  updateLeaderboard();
  updateAchievements();
  renderChick();
}
updateUI();

/* -------- å°é› 10 éšé€²åŒ–å‹•ç•« -------- */
function renderChick(){
  const svg=document.querySelector(".chick-svg");
  let lvl=player.level;
  let fill="#FFEB3B";
  let extra="";
  if(lvl>=2 && lvl<4) extra='<polygon points="100,60 90,50 110,50" fill="#AAFF00"/>';
  if(lvl>=4 && lvl<6) extra='<polygon points="100,50 85,30 115,30" fill="#FFD700"/>';
  if(lvl>=6 && lvl<8) extra='<polygon points="100,40 80,20 120,20" fill="#FFD700"/>';
  if(lvl>=8 && lvl<10) extra='<polygon points="90,150 110,150 100,180" fill="#00BFFF"/>';
  if(lvl>=10) fill="#FFD700";
  svg.innerHTML=`
    <circle cx="100" cy="120" r="50" fill="${fill}"/>
    <circle cx="80" cy="100" r="10"/>
    <circle cx="120" cy="100" r="10"/>
    <polygon points="100,115 90,130 110,130" fill="#FF9800"/>
    <polygon points="60,160 70,140 80,160" fill="#FF9800"/>
    <polygon points="140,160 130,140 120,160" fill="#FF9800"/>
    ${extra}
  `;
}
function chickLevelUp(){
  const chick=document.getElementById("chickContainer");
  chick.classList.add("chick-glow");
  setTimeout(()=>{chick.classList.remove("chick-glow");},1000);
}

/* -------- æˆå°±ç³»çµ± -------- */
function checkAchievements(){
  achievements.forEach(a=>{
    if(!a.done){
      if(a.id===1 && player.level>=2)a.done=true;
      if(a.id===2 && player.level>=5)a.done=true;
      if(a.id===3 && player.todayTime>=1)a.done=true;
      if(a.done) playAudio('achieve');
    }
  });
}
function updateAchievements(){
  let card=document.getElementById("achieveCard");
  card.innerHTML="";
  achievements.forEach(a=>{
    let p=document.createElement("p");
    p.textContent=a.name+" - "+a.desc+" ["+(a.done?"âœ…":"âŒ")+"]";
    card.appendChild(p);
  });
}

/* -------- å°æ¸¬é©— -------- */
const quizQuestions=[
  {q:"ä»Šå¤©ä½ å­¸ç¿’çš„å¿ƒæƒ…ï¼Ÿ", a:["å°ˆæ³¨","ç´¯","ç²¾ç¥"]},
  {q:"ä½ å–œæ­¡å“ªç¨®å°é›å¸½å­ï¼Ÿ", a:["çš‡å† ","æ³•å¸«å¸½","å†’éšªå¸½"]},
  {q:"å¦‚æœé‡åˆ°å›°é›£ï¼Œä½ æœƒï¼Ÿ", a:["åŠªåŠ›è§£æ±º","ä¼‘æ¯","æ‰¾æœ‹å‹"]},
  {q:"å­¸ç¿’ç’°å¢ƒä½ åå¥½ï¼Ÿ", a:["å®‰éœ","éŸ³æ¨‚","ç†±é¬§"]},
  {q:"ä½ è¦ºå¾—è‡ªå·±åƒå“ªéš»å°é›ï¼Ÿ", a:["å‘†èŒ","å‹‡æ•¢","èª¿çš®"]}
];
let quizIndex=0;
function showQuiz(){
  const q=quizQuestions[quizIndex];
  document.getElementById("quizQuestion").textContent=q.q;
  const options=document.getElementById("quizOptions");
  options.innerHTML="";
  q.a.forEach(opt=>{
    const b=document.createElement("button");
    b.className="btn";
    b.textContent=opt;
    b.onclick=nextQuiz;
    options.appendChild(b);
  });
}
function nextQuiz(){
  quizIndex++;
  if(quizIndex<quizQuestions.length){showQuiz();}
  else{document.getElementById("quizResult").textContent="å°é›æ€§æ ¼å·²ç”Ÿæˆ ğŸ¥";}
}
showQuiz();

/* -------- æœ¬åœ°æ’è¡Œæ¦œ + åŒ¿ååˆ†äº«ç¢¼ -------- */
function updateLeaderboard(){
  let card=document.getElementById("leaderboardCard");
  card.innerHTML="ç©å®¶åˆ†æ•¸: "+player.score+" | ç­‰ç´š: "+player.level;
}
function generateShareCode(){
  let data=JSON.stringify(player);
  let code=btoa(data);
  prompt("åˆ†äº«ç¢¼å·²ç”Ÿæˆï¼Œè¤‡è£½çµ¦æœ‹å‹ï¼š", code);
}
function importShareCode(){
  let code=document.getElementById("importCode").value.trim();
  if(!code)return;
  try{
    let data=JSON.parse(atob(code));
    if(data.score>player.score) player.score=data.score;
    if(data.level>player.level) player.level=data.level;
    if(data.todayTime>player.todayTime) player.todayTime=data.todayTime;
    savePlayer();
    updateUI();
    alert("åˆ†æ•¸å·²å°å…¥ï¼");
  }catch(e){alert("åˆ†äº«ç¢¼ç„¡æ•ˆï¼");}
}

/* -------- éŸ³æ•ˆ -------- */
function playAudio(type){
  let url="";
  if(type==='levelup') url="https://freesound.org/data/previews/341/341695_62467-lq.mp3";
  if(type==='achieve') url="https://freesound.org/data/previews/331/331912_3248244-lq.mp3";
  if(type==='pomodoro') url="https://freesound.org/data/previews/331/331906_3248244-lq.mp3";
  let audio=new Audio(url);
  audio.play();
}

/* -------- ç•ªèŒ„é˜ -------- */
let timer=25*60;
let timerInterval;
function updateTimerDisplay(){
  let m=Math.floor(timer/60), s=timer%60;
  document.getElementById("timerDisplay").textContent=(m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(timer<=0){
      clearInterval(timerInterval);
      addEXP(10);
      player.todayTime+=1;
      chickLevelUp();
      playAudio('pomodoro');
      alert("ç•ªèŒ„é˜å®Œæˆï¼+10 EXP + 1å°æ™‚è®€æ›¸");
      updateUI();
      timer=25*60;
      updateTimerDisplay();
      return;
    }
    timer--;
    updateTimerDisplay();
  },1000);
}
function resetTimer(){clearInterval(timerInterval); timer=25*60; updateTimerDisplay();}
updateTimerDisplay();

</script>
</body>
</html>
