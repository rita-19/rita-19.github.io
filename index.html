<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Galaxy RPG å°é›å†’éšªç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin:0; padding:0; font-family:"Microsoft JhengHei",sans-serif; background: linear-gradient(#ffe6f7,#d6e8ff); text-align:center; transition: all 0.5s; color:#000; }
.btn{ padding:10px 15px; margin:5px; border:none; border-radius:12px; background:#ffb8d1; font-size:16px; cursor:pointer; transition:0.3s; }
.btn:hover{background:#ff95be;transform:scale(1.05);}
.card{ display:inline-block; background:white; padding:20px; margin:15px; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.15); width:280px; transition:0.3s;}
.card:hover{transform:scale(1.05);}
.level-bar{ width:80%; height:20px; background:#fff; border-radius:10px; margin:10px auto; overflow:hidden; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);}
.level-progress{ height:100%; background: linear-gradient(90deg,#ff95be,#ffb8d1); width:0%; transition: width 0.5s;}
.chick-container{ width:200px; margin:15px auto; transition: all 0.5s;}
.chick-svg{width:100%;height:auto;}
.chick-glow{filter: drop-shadow(0 0 20px yellow); transform: scale(1.2);}
.chat-input{width:70%; padding:8px; border-radius:10px; border:1px solid #ccc; margin-right:5px;}
.section{display:none;}
.dark-mode{background: linear-gradient(#1c1c1c,#333); color:#fff;}
</style>
</head>
<body>

<h1>ğŸŒŸ Study Galaxy â€“ RPG å°é›å†’éšªç‰ˆ</h1>
<p>å°é›åŠ©æ•™é™ªä½ å­¸ç¿’å†’éšªï¼</p>

<!-- ä½¿ç”¨è€…åç¨± -->
<div class="card">
  <input id="usernameInput" class="chat-input" placeholder="è¼¸å…¥ä½ çš„åå­—â€¦">
  <button class="btn" onclick="loginUser()">ç™»å…¥</button>
</div>

<div>
  <button class="btn" onclick="showSection('home')">ğŸ  é¦–é </button>
  <button class="btn" onclick="showSection('pomodoro')">ğŸ… ç•ªèŒ„é˜</button>
  <button class="btn" onclick="showSection('quiz')">ğŸ® å°æ¸¬é©—</button>
  <button class="btn" onclick="showSection('chart')">ğŸ“Š è®€æ›¸æ•¸æ“š</button>
  <button class="btn" onclick="showSection('leaderboard')">ğŸ† æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="showSection('share')">ğŸ”‘ åˆ†äº«ç¢¼æŸ¥è©¢</button>
  <button class="btn" onclick="toggleMode()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
</div>

<hr style="opacity:0.3; width:80%; margin:20px auto;">

<!-- é¦–é  -->
<section id="home" class="section" style="display:block;">
  <div class="card">
    <h2>ä»Šæ—¥è®€æ›¸æ™‚é–“</h2>
    <p id="todayTime">0 å°æ™‚</p>
  </div>

  <div class="card">
    <h2>å‡ç´šé€²åº¦</h2>
    <div class="level-bar"><div id="levelProgress" class="level-progress"></div></div>
    <p id="levelText">Lv.1 å†’éšªæ–°æ‰‹</p>
  </div>

  <div class="chick-container" id="chickContainer">
    <svg class="chick-svg" viewBox="0 0 200 200">
      <circle cx="100" cy="120" r="50" fill="#FFEB3B"/>
      <circle cx="80" cy="100" r="10" fill="#000"/>
      <circle cx="120" cy="100" r="10" fill="#000"/>
      <polygon points="100,115 90,130 110,130" fill="#FF9800"/>
      <polygon points="60,160 70,140 80,160" fill="#FF9800"/>
      <polygon points="140,160 130,140 120,160" fill="#FF9800"/>
    </svg>
  </div>
</section>

<!-- ç•ªèŒ„é˜ -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div style="font-size:48px; margin:20px;" id="timerDisplay">25:00</div>
  <button class="btn" onclick="startTimer()">â–¶ é–‹å§‹</button>
  <button class="btn" onclick="resetTimer()">ğŸ”„ é‡è¨­</button>
</section>

<!-- å°æ¸¬é©— -->
<section id="quiz" class="section">
  <h2>ğŸ® RPG å°é›å°æ¸¬é©—</h2>
  <div class="card" style="max-width:400px; margin:auto;">
    <p id="quizQuestion">Loading...</p>
    <div id="quizOptions"></div>
    <h3 id="quizResult" style="margin-top:20px;"></h3>
  </div>
</section>

<!-- Chart.js è®€æ›¸æ•¸æ“š -->
<section id="chart" class="section">
  <h2>ğŸ“Š æˆ‘çš„è®€æ›¸ç´€éŒ„</h2>
  <canvas id="studyChart" width="350"></canvas>
</section>

<!-- æ’è¡Œæ¦œ -->
<section id="leaderboard" class="section">
  <h2>ğŸ† æ’è¡Œæ¦œ</h2>
  <div class="card" id="leaderboardList"></div>
</section>

<!-- åˆ†äº«ç¢¼æŸ¥è©¢ -->
<section id="share" class="section">
  <h2>ğŸ”‘ åˆ†äº«ç¢¼æŸ¥è©¢</h2>
  <div class="card">
    <input id="shareInput" class="chat-input" placeholder="è¼¸å…¥ç©å®¶åˆ†äº«ç¢¼â€¦">
    <button class="btn" onclick="queryShare()">æŸ¥è©¢</button>
    <div id="shareResult" style="margin-top:15px;"></div>
  </div>
</section>

<script>
/* ========== é é¢åˆ‡æ› ========== */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* ========== æ·±è‰²æ¨¡å¼ ========== */
let darkMode=false;
function toggleMode(){
  darkMode=!darkMode;
  if(darkMode){document.body.classList.add("dark-mode");}
  else{document.body.classList.remove("dark-mode");}
}

/* ========== ä½¿ç”¨è€…ç™»å…¥ & æœ¬åœ°è³‡æ–™ ========== */
let username = "";
let players = JSON.parse(localStorage.getItem("players")||"{}");
let exp=0, level=1, studyData=[0,0,0,0,0,0,0];
let achievements=[];
function loginUser(){
  const input=document.getElementById("usernameInput").value.trim();
  if(!input){alert("è«‹è¼¸å…¥åç¨±ï¼"); return;}
  username=input;
  if(players[username]){
    ({exp, level, studyData, achievements} = players[username]);
  } else {
    players[username]={exp:0,level:1,studyData:[0,0,0,0,0,0,0],achievements:[]};
    exp=0; level=1; studyData=[0,0,0,0,0,0,0]; achievements=[];
    savePlayers();
  }
  updateLevelUI(); updateChart(); updateTodayTime(); updateLeaderboard();
  alert(`ç™»å…¥æˆåŠŸï¼ä½ çš„åˆ†äº«ç¢¼æ˜¯ï¼š${username}`);
}
function savePlayers(){
  players[username]={exp, level, studyData, achievements};
  localStorage.setItem("players", JSON.stringify(players));
}

/* ========== ç•ªèŒ„é˜ ========== */
let timer=25*60; let timerInterval;
function updateTimerDisplay(){
  let m=Math.floor(timer/60), s=timer%60;
  document.getElementById("timerDisplay").textContent=(m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(timer<=0){
      clearInterval(timerInterval); addEXP(10); addStudyTime(1); playDing(); alert("ç•ªèŒ„é˜å®Œæˆï¼+10 EXP + 1å°æ™‚è®€æ›¸"); return;
    }
    timer--; updateTimerDisplay();
  },1000);
}
function resetTimer(){clearInterval(timerInterval); timer=25*60; updateTimerDisplay();}
updateTimerDisplay();

/* ========== éŸ³æ•ˆ ========== */
function playDing(){ new Audio("https://freesound.org/data/previews/341/341695_62467-lq.mp3").play();}
function playLevelUp(){ new Audio("https://freesound.org/data/previews/331/331912_3248244-lq.mp3").play();}
function playAchievement(){ new Audio("https://freesound.org/data/previews/256/256113_3263906-lq.mp3").play();}

/* ========== EXP / å‡ç´š / å°é›å‡ç´šå‹•ç•« ========== */
function addEXP(amount){
  exp+=amount; checkLevelUp(); updateLevelUI(); savePlayers();
}
function checkLevelUp(){
  let needed=level*50;
  while(exp>=needed){
    exp-=needed; level++; playLevelUp(); chickLevelUp(); checkAchievement(); needed=level*50;
  }
}
function updateLevelUI(){
  let percent=(exp/(level*50))*100;
  document.getElementById("levelProgress").style.width=percent+"%";
  document.getElementById("levelText").textContent="Lv."+level+" å†’éšªè€…";
}
function chickLevelUp(){
  const chick=document.getElementById("chickContainer");
  chick.classList.add("chick-glow");
  setTimeout(()=>{chick.classList.remove("chick-glow");},1000);
  const svg=chick.querySelector(".chick-svg");
  if(level==2){svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/>';}
  else if(level==3){svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/>';}
  else if(level>=4){svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/>';}
}

/* ========== æˆå°±ç³»çµ± ========== */
function checkAchievement(){
  if(level>=5 && !achievements.includes("å‡åˆ°Lv5")){achievements.push("å‡åˆ°Lv5"); playAchievement(); alert("é”æˆæˆå°±ï¼šå‡åˆ°Lv5ï¼");}
  if(level>=10 && !achievements.includes("å‡åˆ°Lv10")){achievements.push("å‡åˆ°Lv10"); playAchievement(); alert("é”æˆæˆå°±ï¼šå‡åˆ°Lv10ï¼");}
}

/* ========== å°æ¸¬é©— ========== */
const quizQuestions=[
  {q:"ä»Šå¤©ä½ å­¸ç¿’çš„å¿ƒæƒ…ï¼Ÿ", a:["å°ˆæ³¨","ç´¯","ç²¾ç¥"]},
  {q:"ä½ å–œæ­¡å“ªç¨®å°é›å¸½å­ï¼Ÿ", a:["çš‡å† ","æ³•å¸«å¸½","å†’éšªå¸½"]},
  {q:"å¦‚æœé‡åˆ°å›°é›£ï¼Œä½ æœƒï¼Ÿ", a:["åŠªåŠ›è§£æ±º","ä¼‘æ¯","æ‰¾æœ‹å‹"]},
  {q:"å­¸ç¿’ç’°å¢ƒä½ åå¥½ï¼Ÿ", a:["å®‰éœ","éŸ³æ¨‚","ç†±é¬§"]},
  {q:"ä½ è¦ºå¾—è‡ªå·±åƒå“ªéš»å°é›ï¼Ÿ", a:["å‘†èŒ","å‹‡æ•¢","èª¿çš®"]}
];
let quizIndex=0;
function showQuiz(){ const q=quizQuestions[quizIndex]; document.getElementById("quizQuestion").textContent=q.q; const options=document.getElementById("quizOptions"); options.innerHTML=""; q.a.forEach(opt=>{ const b=document.createElement("button"); b.className="btn"; b.textContent=opt; b.onclick=nextQuiz; options.appendChild(b);});}
function nextQuiz(){ quizIndex++; if(quizIndex<quizQuestions.length){showQuiz();} else{document.getElementById("quizResult").textContent="å°é›æ€§æ ¼å·²ç”Ÿæˆ ğŸ¥";}}
showQuiz();

/* ========== Chart.js è®€æ›¸ç´€éŒ„ ========== */
const ctx=document.getElementById("studyChart").getContext("2d");
let studyChart=new Chart(ctx,{ type:'line', data:{ labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"], datasets:[{ label:"è®€æ›¸æ™‚é–“(å°æ™‚)", data:studyData, borderColor:"#ff8bb5", backgroundColor:"#ffbcd9", tension:0.3 }] }, options:{scales:{y:{beginAtZero:true}}} });
function addStudyTime(hours){
  const day=new Date().getDay(); const index=(day==0?6:day-1);
  studyData[index]+=hours; savePlayers(); updateChart(); updateTodayTime(); updateLeaderboard();
}
function updateChart(){ studyChart.data.datasets[0].data=studyData; studyChart.update(); }
function updateTodayTime(){ const day=new Date().getDay(); const index=(day==0?6:day-1); document.getElementById("todayTime").textContent=studyData[index]+" å°æ™‚"; }

/* ========== æ’è¡Œæ¦œ ========== */
function updateLeaderboard(){
  const list=document.getElementById("leaderboardList");
  let arr=Object.keys(players).map(k=>({name:k,exp:players[k].exp}));
  arr.sort((a,b)=>b.exp-a.exp);
  list.innerHTML="";
  arr.forEach(p=>{ const div=document.createElement("div"); div.textContent=`${p.name}ï¼š${p.exp} EXP`; list.appendChild(div);});
}

/* ========== åˆ†äº«ç¢¼æŸ¥è©¢ ========== */
function queryShare(){
  const code=document.getElementById("shareInput").value.trim();
  const res=document.getElementById("shareResult");
  if(!code){res.innerHTML="è«‹è¼¸å…¥åˆ†äº«ç¢¼ï¼"; return;}
  if(!players[code]){res.innerHTML="æ‰¾ä¸åˆ°ç©å®¶ï¼"; return;}
  const p=players[code];
  res.innerHTML=`<p>åç¨±ï¼š${code}</p><p>Lvï¼š${p.level}</p><p>EXPï¼š${p.exp}</p><p>ä»Šæ—¥è®€æ›¸æ™‚é–“ï¼š${p.studyData[new Date().getDay()==0?6:new Date().getDay()-1]} å°æ™‚</p><p>æˆå°±ï¼š${p.achievements.join(", ")||"ç„¡"}</p>`;
}

</script>
</body>
</html>
