<!-- -------------------- å°æ¸¬é©— -------------------- -->
<section id="quiz" class="section" style="display:none;">
  <h2>ğŸ® RPG å°é›å°æ¸¬é©—</h2>
  <div class="card" style="max-width:400px; margin:auto;">
    <p id="quizQuestion">Loading...</p>
    <div id="quizOptions"></div>
    <h3 id="quizResult" style="margin-top:20px;"></h3>
  </div>
</section>

<!-- -------------------- AI å°è€å¸« -------------------- -->
<section id="ai" class="section" style="display:none;">
  <h2>âœ¨ AI å°è€å¸«</h2>
  <div class="card" style="max-width:500px; margin:auto;">
    <div class="chat-log" id="chatLog" style="height:220px; overflow-y:auto; background:#f6f6f6; padding:10px; border-radius:10px; margin-bottom:12px;"></div>
    <input id="chatInput" class="chat-input" placeholder="è¼¸å…¥ä½ çš„å•é¡Œâ€¦">
    <button class="btn" onclick="aiReply()">é€å‡º</button>
  </div>
</section>

<!-- -------------------- Chart.js è®€æ›¸æ•¸æ“š -------------------- -->
<section id="chart" class="section" style="display:none;">
  <h2>ğŸ“Š æˆ‘çš„è®€æ›¸ç´€éŒ„</h2>
  <canvas id="studyChart" width="350"></canvas>
</section>

<!-- -------------------- JS åŠŸèƒ½ -------------------- -->
<script>
/* ==================== é é¢åˆ‡æ› ==================== */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* ==================== æ·±è‰²æ¨¡å¼ ==================== */
let darkMode=false;
function toggleMode(){
  darkMode=!darkMode;
  if(darkMode){
    document.body.style.background="linear-gradient(#1c1c1c,#333)";
    document.body.style.color="#fff";
  }else{
    document.body.style.background="linear-gradient(#ffe6f7,#d6e8ff)";
    document.body.style.color="#000";
  }
}

/* ==================== ç•ªèŒ„é˜ ==================== */
let timer=25*60;
let timerInterval;
function updateTimerDisplay(){
  let m=Math.floor(timer/60), s=timer%60;
  document.getElementById("timerDisplay").textContent=
    (m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(timer<=0){
      clearInterval(timerInterval);
      addEXP(10);
      playDing();
      chickLevelUp();
      alert("ç•ªèŒ„é˜å®Œæˆï¼+10 EXP");
      return;
    }
    timer--;
    updateTimerDisplay();
  },1000);
}
function resetTimer(){clearInterval(timerInterval); timer=25*60; updateTimerDisplay();}
updateTimerDisplay();

/* ==================== ç•ªèŒ„é˜éŸ³æ•ˆ ==================== */
function playDing(){
  const audio=new Audio("https://freesound.org/data/previews/341/341695_62467-lq.mp3");
  audio.play();
}

/* ==================== EXP / å‡ç´šç³»çµ± ==================== */
let exp=localStorage.getItem("exp")?parseInt(localStorage.getItem("exp")):0;
let level=localStorage.getItem("level")?parseInt(localStorage.getItem("level")):1;
function addEXP(amount){
  exp+=amount;
  localStorage.setItem("exp",exp);
  checkLevelUp();
  updateLevelUI();
}
function checkLevelUp(){
  let needed=level*50;
  while(exp>=needed){
    exp-=needed;
    level++;
    localStorage.setItem("level",level);
    needed=level*50;
    chickLevelUp();
  }
}
function updateLevelUI(){
  let percent=(exp/(level*50))*100;
  document.getElementById("levelProgress").style.width=percent+"%";
  document.getElementById("levelText").textContent="Lv."+level+" å†’éšªè€…";
}
updateLevelUI();

/* ==================== å°é›å‡ç´šå‹•ç•« ==================== */
function chickLevelUp(){
  const chick=document.getElementById("chickContainer");
  chick.classList.add("chick-glow");
  setTimeout(()=>{chick.classList.remove("chick-glow");},1000);
  // SVG é€²åŒ– Lv1-Lv5
  const svg=chick.querySelector(".chick-svg");
  if(level==2){svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/><circle cx="80" cy="100" r="10"/><circle cx="120" cy="100" r="10"/><polygon points="100,115 90,130 110,130" fill="#FF9800"/><polygon points="60,160 70,140 80,160" fill="#FF9800"/><polygon points="140,160 130,140 120,160" fill="#FF9800"/><polygon points="100,60 90,50 110,50" fill="#AAFF00"/>';}
  else if(level==3){svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/><circle cx="80" cy="100" r="10"/><circle cx="120" cy="100" r="10"/><polygon points="100,115 90,130 110,130" fill="#FF9800"/><polygon points="60,160 70,140 80,160" fill="#FF9800"/><polygon points="140,160 130,140 120,160" fill="#FF9800"/><polygon points="100,50 85,30 115,30" fill="#FFD700"/>';}
  else if(level>=4){svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/><circle cx="80" cy="100" r="10"/><circle cx="120" cy="100" r="10"/><polygon points="100,115 90,130 110,130" fill="#FF9800"/><polygon points="60,160 70,140 80,160" fill="#FF9800"/><polygon points="140,160 130,140 120,160" fill="#FF9800"/><polygon points="100,40 80,20 120,20" fill="#FFD700"/><polygon points="90,150 110,150 100,180" fill="#00BFFF"/>';}
}

/* ==================== Chart.js è®€æ›¸ç´€éŒ„ ==================== */
const studyData=localStorage.getItem("studyData")?JSON.parse(localStorage.getItem("studyData")):[0,0,0,0,0,0,0];
const studyChart=new Chart(document.getElementById("studyChart"),{
  type:'line',
  data:{
    labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
    datasets:[{
      label:"è®€æ›¸æ™‚é–“(å°æ™‚)",
      data:studyData,
      borderColor:"#ff8bb5",
      backgroundColor:"#ffbcd9",
      tension:0.3
    }]
  },
  options:{scales:{y:{beginAtZero:true}}}
});
function addStudyTime(hours){
  const day=new Date().getDay(); //0=Sun
  const index=(day==0?6:day-1);
  studyData[index]+=hours;
  localStorage.setItem("studyData",JSON.stringify(studyData));
  studyChart.data.datasets[0].data=studyData;
  studyChart.update();
  document.getElementById("todayTime").textContent=studyData[index]+" å°æ™‚";
}
addStudyTime(0);

/* ==================== AI å°è€å¸« ==================== */
function aiReply(){
  const log=document.getElementById("chatLog");
  const input=document.getElementById("chatInput").value;
  if(input.trim()==="") return;
  log.innerHTML+=`<p><b>ä½ ï¼š</b>${input}</p>`;
  const reply="é€™é¡Œä½ å¯ä»¥é€™æ¨£æƒ³ï¼šæŠŠå•é¡Œæ‹†å°ä¸€æ­¥æ­¥è§£ï¼Œå°±æœƒæ›´æ¸…æ¥šå–”ï¼âœ¨";
  log.innerHTML+=`<p><b>AI å°è€å¸«ï¼š</b>${reply}</p>`;
  document.getElementById("chatInput").value="";
  log.scrollTop=log.scrollHeight;
}

/* ==================== å°æ¸¬é©— ==================== */
const quizQuestions=[
  {q:"ä»Šå¤©ä½ å­¸ç¿’çš„å¿ƒæƒ…ï¼Ÿ", a:["å°ˆæ³¨","ç´¯","ç²¾ç¥"]},
  {q:"ä½ å–œæ­¡å“ªç¨®å°é›å¸½å­ï¼Ÿ", a:["çš‡å† ","æ³•å¸«å¸½","å†’éšªå¸½"]},
  {q:"å¦‚æœé‡åˆ°å›°é›£ï¼Œä½ æœƒï¼Ÿ", a:["åŠªåŠ›è§£æ±º","ä¼‘æ¯","æ‰¾æœ‹å‹"]},
  {q:"å­¸ç¿’ç’°å¢ƒä½ åå¥½ï¼Ÿ", a:["å®‰éœ","éŸ³æ¨‚","ç†±é¬§"]},
  {q:"ä½ è¦ºå¾—è‡ªå·±åƒå“ªéš»å°é›ï¼Ÿ", a:["å‘†èŒ","å‹‡æ•¢","èª¿çš®"]}
];
let quizIndex=0;
function showQuiz(){
  const q=quizQuestions[quizIndex];
  document.getElementById("quizQuestion").textContent=q.q;
  const options=document.getElementById("quizOptions");
  options.innerHTML="";
  q.a.forEach(opt=>{
    const b=document.createElement("button");
    b.className="btn";
    b.textContent=opt;
    b.onclick=nextQuiz;
    options.appendChild(b);
  });
}
function nextQuiz(){
  quizIndex++;
  if(quizIndex<quizQuestions.length){showQuiz();}
  else{document.getElementById("quizResult").textContent="å°é›æ€§æ ¼å·²ç”Ÿæˆ ğŸ¥";}
}
showQuiz();

</script>
