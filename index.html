<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Galaxy RPG å°é›å†’éšªç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin:0; padding:0; font-family:"Microsoft JhengHei",sans-serif;
  background: linear-gradient(#ffe6f7,#d6e8ff); text-align:center;
  transition: all 0.5s; color:#000; }
.btn{ padding:10px 15px; margin:5px; border:none; border-radius:12px;
  background:#ffb8d1; font-size:16px; cursor:pointer; transition:0.3s; }
.btn:hover{background:#ff95be; transform:scale(1.05);}
.card{ display:inline-block; background:white; padding:20px; margin:15px;
  border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
  width:280px; transition:0.3s; }
.card:hover{transform:scale(1.05);}
.level-bar{ width:80%; height:20px; background:#fff; border-radius:10px;
  margin:10px auto; overflow:hidden; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);}
.level-progress{ height:100%; background: linear-gradient(90deg,#ff95be,#ffb8d1);
  width:0%; transition: width 0.5s; }
.chick-container{ width:200px; margin:15px auto; transition: all 0.5s; }
.chick-svg{width:100%;height:auto;}
.chick-glow{filter: drop-shadow(0 0 20px yellow); transform: scale(1.2);}
.section{display:none;}
input[type=text]{padding:8px; border-radius:10px; border:1px solid #ccc; width:150px;}
</style>
</head>
<body>

<h1>ğŸŒŸ Study Galaxy â€“ RPG å°é›å†’éšªç‰ˆ</h1>
<p>å°é›åŠ©æ•™é™ªä½ å­¸ç¿’å†’éšªï¼</p>

<div class="card">
  <input type="text" id="playerName" placeholder="è¼¸å…¥åç¨±">
  <button class="btn" onclick="savePlayerName()">è¨­å®šåç¨±</button>
</div>

<div>
  <button class="btn" onclick="showSection('home')">ğŸ  é¦–é </button>
  <button class="btn" onclick="showSection('pomodoro')">ğŸ… ç•ªèŒ„é˜</button>
  <button class="btn" onclick="showSection('achievements')">ğŸ† æˆå°±</button>
  <button class="btn" onclick="showSection('chart')">ğŸ“Š è®€æ›¸æ•¸æ“š</button>
  <button class="btn" onclick="showSection('leaderboard')">ğŸ¥‡ æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="toggleMode()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
</div>

<hr style="opacity:0.3; width:80%; margin:20px auto;">

<!-- é¦–é  -->
<section id="home" class="section" style="display:block;">
  <div class="card">
    <h2>ä»Šæ—¥è®€æ›¸æ™‚é–“</h2>
    <p id="todayTime">0 å°æ™‚</p>
  </div>
  <div class="card">
    <h2>å‡ç´šé€²åº¦</h2>
    <div class="level-bar"><div id="levelProgress" class="level-progress"></div></div>
    <p id="levelText">Lv.1 å†’éšªè€…</p>
  </div>
  <div class="chick-container" id="chickContainer">
    <svg class="chick-svg" viewBox="0 0 200 200">
      <circle cx="100" cy="120" r="50" fill="#FFEB3B"/>
      <circle cx="80" cy="100" r="10" fill="#000"/>
      <circle cx="120" cy="100" r="10" fill="#000"/>
      <polygon points="100,115 90,130 110,130" fill="#FF9800"/>
      <polygon points="60,160 70,140 80,160" fill="#FF9800"/>
      <polygon points="140,160 130,140 120,160" fill="#FF9800"/>
    </svg>
  </div>

  <!-- åˆ†äº«ç¢¼ -->
  <div class="card">
    <button class="btn" onclick="generateShareCode()">ğŸ“ ç”Ÿæˆåˆ†äº«ç¢¼</button>
    <p id="shareCodeDisplay"></p>
  </div>
  <div class="card">
    <input type="text" id="inputShareCode" placeholder="è¼¸å…¥åˆ†äº«ç¢¼æŸ¥çœ‹åˆ†æ•¸">
    <button class="btn" onclick="viewSharedScore()">ğŸ” æŸ¥çœ‹</button>
    <p id="sharedScoreDisplay"></p>
  </div>
</section>

<!-- ç•ªèŒ„é˜ -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div style="font-size:48px; margin:20px;" id="timerDisplay">25:00</div>
  <button class="btn" onclick="startTimer()">â–¶ é–‹å§‹</button>
  <button class="btn" onclick="resetTimer()">ğŸ”„ é‡è¨­</button>
</section>

<!-- æˆå°± -->
<section id="achievements" class="section">
  <h2>ğŸ† æˆå°±</h2>
  <div id="achievementsList" class="card"></div>
</section>

<!-- Chart.js è®€æ›¸æ•¸æ“š -->
<section id="chart" class="section">
  <h2>ğŸ“Š æˆ‘çš„è®€æ›¸ç´€éŒ„</h2>
  <canvas id="studyChart" width="350"></canvas>
</section>

<!-- æ’è¡Œæ¦œ -->
<section id="leaderboard" class="section">
  <h2>ğŸ¥‡ æ’è¡Œæ¦œ</h2>
  <div id="leaderboardList" class="card"></div>
</section>

<script>
/* =================== å…¨åŸŸè®Šæ•¸ =================== */
let darkMode=false;
let timer=25*60, timerInterval;
let player={name:"", score:0, level:1, exp:0};
let achievements=[], studyData=[0,0,0,0,0,0,0];
let maxLevel=10;

/* =================== é é¢åˆ‡æ› =================== */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* =================== æ·±è‰²æ¨¡å¼ =================== */
function toggleMode(){
  darkMode=!darkMode;
  if(darkMode){
    document.body.style.background="linear-gradient(#1c1c1c,#333)";
    document.body.style.color="#fff";
  }else{
    document.body.style.background="linear-gradient(#ffe6f7,#d6e8ff)";
    document.body.style.color="#000";
  }
}

/* =================== ç©å®¶åç¨± =================== */
function savePlayerName(){
  const nameInput = document.getElementById("playerName").value.trim();
  if(!nameInput){ alert("è«‹è¼¸å…¥åç¨±ï¼"); return; }

  const storedPlayers = JSON.parse(localStorage.getItem("allPlayers")||"{}");
  if(storedPlayers[nameInput]){
    player = storedPlayers[nameInput];
    achievements = player.achievements||[];
    studyData = player.studyData||[0,0,0,0,0,0,0];
    alert("æ­¡è¿å›ä¾†ï¼Œ"+nameInput+"ï¼ç´€éŒ„å·²è¼‰å…¥ã€‚");
  } else {
    player = { name: nameInput, score:0, level:1, exp:0 };
    achievements = [];
    studyData = [0,0,0,0,0,0,0];
    alert("æ­¡è¿æ–°ç©å®¶ "+nameInput+"ï¼å·²å»ºç«‹æ–°ç´€éŒ„ã€‚");
  }
  saveAllPlayers();
  updateUI();
}

/* =================== å„²å­˜ç©å®¶ =================== */
function saveAllPlayers(){
  const storedPlayers = JSON.parse(localStorage.getItem("allPlayers")||"{}");
  storedPlayers[player.name] = { ...player, achievements, studyData, shareCode:player.shareCode||"" };
  localStorage.setItem("allPlayers", JSON.stringify(storedPlayers));
}

/* =================== åˆ†äº«ç¢¼ =================== */
function generateShareCode(){
  const code = Math.random().toString(36).substring(2,8).toUpperCase();
  player.shareCode = code;
  saveAllPlayers();
  document.getElementById("shareCodeDisplay").textContent = "ä½ çš„åˆ†äº«ç¢¼ï¼š"+code;
}

function viewSharedScore(){
  const code = document.getElementById("inputShareCode").value.trim().toUpperCase();
  if(!code){ alert("è«‹è¼¸å…¥åˆ†äº«ç¢¼ï¼"); return; }
  const storedPlayers = JSON.parse(localStorage.getItem("allPlayers")||"{}");
  const found = Object.values(storedPlayers).find(p=>p.shareCode===code);
  if(found){
    document.getElementById("sharedScoreDisplay").textContent = found.name + " çš„åˆ†æ•¸ï¼š"+found.score;
  } else {
    document.getElementById("sharedScoreDisplay").textContent = "æ‰¾ä¸åˆ°å°æ‡‰ç©å®¶";
  }
}

/* =================== ç•ªèŒ„é˜ =================== */
function updateTimerDisplay(){
  let m=Math.floor(timer/60), s=timer%60;
  document.getElementById("timerDisplay").textContent=
    (m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(timer<=0){
      clearInterval(timerInterval);
      addEXP(10);
      addStudyTime(1);
      playSound("ding");
      alert("ç•ªèŒ„é˜å®Œæˆï¼+10 EXP +1å°æ™‚è®€æ›¸");
      return;
    }
    timer--; updateTimerDisplay();
  },1000);
}
function resetTimer(){clearInterval(timerInterval); timer=25*60; updateTimerDisplay();}
updateTimerDisplay();

/* =================== éŸ³æ•ˆ =================== */
function playSound(type){
  let url="";
  if(type==="ding") url="https://freesound.org/data/previews/341/341695_62467-lq.mp3";
  else if(type==="level") url="https://freesound.org/data/previews/170/170664_2437358-lq.mp3";
  else if(type==="achievement") url="https://freesound.org/data/previews/399/399447_5121236-lq.mp3";
  if(url){ const audio=new Audio(url); audio.play(); }
}

/* =================== EXP / ç­‰ç´š =================== */
function addEXP(amount){
  player.exp+=amount; player.score+=amount;
  checkLevelUp(); saveAllPlayers(); updateUI();
}
function checkLevelUp(){
  let needed=player.level*50;
  while(player.exp>=needed && player.level<maxLevel){
    player.exp-=needed; player.level++;
    chickLevelUp(); playSound("level");
    needed=player.level*50;
    checkAchievements();
  }
  updateLevelUI();
}
function updateLevelUI(){
  let percent=(player.exp/(player.level*50))*100;
  document.getElementById("levelProgress").style.width=percent+"%";
  document.getElementById("levelText").textContent="Lv."+player.level+" å†’éšªè€…";
}

/* =================== å°é›é€²åŒ– 10 éš =================== */
function chickLevelUp(){
  const chick=document.getElementById("chickContainer");
  chick.classList.add("chick-glow");
  setTimeout(()=>{chick.classList.remove("chick-glow");},1000);
  const svg=chick.querySelector(".chick-svg");
  let colors=["#FFEB3B","#FFD700","#FF9800","#00BFFF","#AAFF00","#FF69B4","#FFA500","#ADFF2F","#00FA9A","#FF4500"];
  let size=50 + player.level*2;
  svg.innerHTML='<circle cx="100" cy="120" r="'+size+'" fill="'+colors[player.level-1]+'"/>';
}

/* =================== æˆå°±ç³»çµ± =================== */
function checkAchievements(){
  const achDiv=document.getElementById("achievementsList");
  let newAch=false;
  const achMap = [
    {name:"ç¬¬ä¸€æ¬¡å‡ç´š", condition:()=>player.level>=2},
    {name:"å°é›å‹‡è€…", condition:()=>player.level>=5},
    {name:"è®€æ›¸é”äºº", condition:()=>studyData.reduce((a,b)=>a+b,0)>=5},
    {name:"è¶…ç´šå‹‡è€…", condition:()=>player.level>=10}
  ];
  achDiv.innerHTML="";
  achMap.forEach(a=>{
    if(a.condition() && !achievements.includes(a.name)){
      achievements.push(a.name); playSound("achievement"); newAch=true;
    }
    if(achievements.includes(a.name)){
      achDiv.innerHTML+="<p>ğŸ† "+a.name+"</p>";
    }
  });
  if(newAch) saveAllPlayers();
}

/* =================== è®€æ›¸ç´€éŒ„ =================== */
function addStudyTime(hours){
  const day=new Date().getDay();
  const index=(day==0?6:day-1);
  studyData[index]+=hours;
  player.studyData = studyData;
  saveAllPlayers();
  document.getElementById("todayTime").textContent=studyData[index]+" å°æ™‚";
  updateChart();
  checkAchievements();
}
const studyChart=new Chart(document.getElementById("studyChart"),{
  type:'line',
  data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"], datasets:[{label:"è®€æ›¸æ™‚é–“(å°æ™‚)",data:studyData,borderColor:"#ff8bb5",backgroundColor:"#ffbcd9",tension:0.3}]},
  options:{scales:{y:{beginAtZero:true}}}
});
function updateChart(){ studyChart.data.datasets[0].data=studyData; studyChart.update(); }

/* =================== æ’è¡Œæ¦œ =================== */
function updateLeaderboard(){
  const lbDiv=document.getElementById("leaderboardList");
  const storedPlayers=JSON.parse(localStorage.getItem("allPlayers")||"{}");
  const sorted = Object.values(storedPlayers).sort((a,b)=>b.score-a.score);
  lbDiv.innerHTML="";
  sorted.forEach((p,i)=>{
    lbDiv.innerHTML+="<p>"+(i+1)+". "+p.name+" - "+p.score+"åˆ†</p>";
  });
}

/* =================== æ›´æ–° UI =================== */
function updateUI(){
  updateLevelUI();
  document.getElementById("todayTime").textContent=studyData[new Date().getDay()?new Date().getDay()-1:6]+" å°æ™‚";
  updateLeaderboard();
  updateChart();
  checkAchievements();
}
updateUI();
</script>

</body>
</html>
