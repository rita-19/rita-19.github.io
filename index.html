<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Program</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* -------------------- å…¨åŸŸ -------------------- */
body{
  margin:0; padding:0;
  font-family:"Microsoft JhengHei",sans-serif;
  background: linear-gradient(#ffe6f7,#d6e8ff);
  text-align:center;
  transition: all 0.5s;
  color:#000;
}
.btn{
  padding:10px 15px;
  margin:5px;
  border:none;
  border-radius:12px;
  background:#ffb8d1;
  font-size:16px;
  cursor:pointer;
  transition:0.3s;
}
.btn:hover{background:#ff95be;transform:scale(1.05);}
.card{
  display:inline-block;
  background:white;
  padding:20px;
  margin:15px;
  border-radius:20px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  width:280px;
  transition:0.3s;
}
.card:hover{transform:scale(1.05);}
.level-bar{
  width:80%; height:20px;
  background:#fff;
  border-radius:10px;
  margin:10px auto;
  overflow:hidden;
  box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);
}
.level-progress{
  height:100%;
  background: linear-gradient(90deg,#ff95be,#ffb8d1);
  width:0%;
  transition: width 0.5s;
}
.chick-container{
  width:200px;
  margin:15px auto;
  transition: all 0.5s;
}
.chick-svg{width:100%;height:auto;}
.chick-glow{filter: drop-shadow(0 0 20px yellow); transform: scale(1.2);}
.chat-input{width:70%; padding:8px; border-radius:10px; border:1px solid #ccc; margin-right:5px;}
.section{display:none;}

/* æˆå°±æç¤º */
.achievement-popup{
  position:fixed;
  top:20px; left:50%;
  transform:translateX(-50%);
  background: #ffeb3b;
  color:#000;
  padding:12px 24px;
  border-radius:20px;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  font-weight:bold;
  z-index:9999;
  animation: popupAnim 1.5s forwards;
}
@keyframes popupAnim{
  0%{opacity:0; transform:translateX(-50%) translateY(-20px);}
  10%{opacity:1; transform:translateX(-50%) translateY(0);}
  90%{opacity:1; transform:translateX(-50%) translateY(0);}
  100%{opacity:0; transform:translateX(-50%) translateY(-20px);}
}

/* -------------------- æ·±è‰²æ¨¡å¼ -------------------- */
.dark-mode {
  background: linear-gradient(#1c1c1c,#333);
  color:#fff;
}
.dark-mode .btn {
  background: #555;
  color: #fff;
}
.dark-mode .btn:hover {background:#777;}
.dark-mode .card {
  background: #222;
  color:#fff;
  box-shadow:0 4px 12px rgba(255,255,255,0.1);
}
.dark-mode .chat-input {
  background:#333;
  color:#fff;
  border:1px solid #555;
}
</style>
</head>
<body>

<h1>ğŸŒŸ Study Program</h1>
<p>å°é›åŠ©æ•™é™ªä½ å­¸ç¿’å†’éšªï¼</p>

<div>
  <button class="btn" onclick="showSection('home')">ğŸ  é¦–é </button>
  <button class="btn" onclick="showSection('pomodoro')">ğŸ… ç•ªèŒ„é˜</button>
  <button class="btn" onclick="showSection('quiz')">ğŸ® å°æ¸¬é©—</button>
  <button class="btn" onclick="showSection('chart')">ğŸ“Š è®€æ›¸æ•¸æ“š</button>
  <button class="btn" onclick="showSection('leaderboard')">ğŸ† æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="toggleMode()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
</div>

<hr style="opacity:0.3; width:80%; margin:20px auto;">

<!-- -------------------- é¦–é  -------------------- -->
<section id="home" class="section" style="display:block;">
  <div class="card">
    <h2>ä»Šæ—¥è®€æ›¸æ™‚é–“</h2>
    <p id="todayTime">0 å°æ™‚</p>
  </div>

  <div class="card">
    <h2>å‡ç´šé€²åº¦</h2>
    <div class="level-bar"><div id="levelProgress" class="level-progress"></div></div>
    <p id="levelText">Lv.1 å†’éšªæ–°æ‰‹</p>
  </div>

  <div class="chick-container" id="chickContainer">
    <svg class="chick-svg" viewBox="0 0 200 200">
      <circle cx="100" cy="120" r="50" fill="#FFEB3B"/>
      <circle cx="80" cy="100" r="10" fill="#000"/>
      <circle cx="120" cy="100" r="10" fill="#000"/>
      <polygon points="100,115 90,130 110,130" fill="#FF9800"/>
      <polygon points="60,160 70,140 80,160" fill="#FF9800"/>
      <polygon points="140,160 130,140 120,160" fill="#FF9800"/>
    </svg>
  </div>
</section>

<!-- -------------------- ç•ªèŒ„é˜ -------------------- -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div style="font-size:48px; margin:20px;" id="timerDisplay">25:00</div>
  <button class="btn" onclick="startTimer()">â–¶ é–‹å§‹</button>
  <button class="btn" onclick="resetTimer()">ğŸ”„ é‡è¨­</button>
</section>

<!-- -------------------- å°æ¸¬é©— -------------------- -->
<section id="quiz" class="section">
  <h2>ğŸ® RPG å°é›å°æ¸¬é©—</h2>
  <div class="card" style="max-width:400px; margin:auto;">
    <p id="quizQuestion">Loading...</p>
    <div id="quizOptions"></div>
    <h3 id="quizResult" style="margin-top:20px;"></h3>
  </div>
</section>

<!-- -------------------- Chart.js è®€æ›¸æ•¸æ“š -------------------- -->
<section id="chart" class="section">
  <h2>ğŸ“Š æˆ‘çš„è®€æ›¸ç´€éŒ„</h2>
  <canvas id="studyChart" width="350"></canvas>
</section>

<!-- -------------------- æ’è¡Œæ¦œ + ç™»å…¥ + åˆ†äº«ç¢¼ -------------------- -->
<section id="leaderboard" class="section">
  <h2>ğŸ† æ’è¡Œæ¦œ</h2>
  <div class="card" style="max-width:400px; margin:auto;">
    <input id="playerName" class="chat-input" placeholder="è¼¸å…¥ä½ çš„åç¨±">
    <button class="btn" onclick="loginPlayer()">ç™»å…¥</button>
    <p>ä½ çš„åˆ†äº«ç¢¼ï¼š<span id="shareCode">ç„¡</span></p>
    <input id="shareCodeInput" class="chat-input" placeholder="è¼¸å…¥åˆ†äº«ç¢¼">
    <button class="btn" onclick="loadByShareCode()">æŸ¥è©¢ç©å®¶</button>
    <ul id="leaderboardList" style="text-align:left;"></ul>
  </div>
</section>

<script>
/* ========== é é¢åˆ‡æ› ========== */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* ========== æ·±è‰²æ¨¡å¼ ========== */
let darkMode=false;
function toggleMode(){
  darkMode = !darkMode;
  document.body.classList.toggle("dark-mode", darkMode);

  studyChart.options.scales.x.ticks.color = darkMode ? "#fff" : "#000";
  studyChart.options.scales.y.ticks.color = darkMode ? "#fff" : "#000";
  studyChart.update();
}

/* ========== ç•ªèŒ„é˜ ========== */
let timer=25*60, timerInterval;
function updateTimerDisplay(){
  let m=Math.floor(timer/60), s=timer%60;
  document.getElementById("timerDisplay").textContent= (m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(timer<=0){
      clearInterval(timerInterval);
      addEXP(10);
      addStudyTime(0.5);
      playDing('pomodoro');
      checkAchievements('pomodoro');
      chickLevelUp();
      showAchievementPopup("ğŸ… ç•ªèŒ„é˜å®Œæˆ +10 EXP");
      savePlayerData();
      return;
    }
    timer--;
    updateTimerDisplay();
  },1000);
}
function resetTimer(){clearInterval(timerInterval); timer=25*60; updateTimerDisplay();}
updateTimerDisplay();

/* ========== éŸ³æ•ˆ ========== */
function playDing(type){
  let url='';
  if(type==='pomodoro') url="https://freesound.org/data/previews/341/341695_62467-lq.mp3";
  else if(type==='level') url="https://freesound.org/data/previews/350/350246_62467-lq.mp3";
  else if(type==='achievement') url="https://freesound.org/data/previews/331/331912_62467-lq.mp3";
  if(url){ const audio=new Audio(url); audio.play(); }
}

/* ========== EXP / å‡ç´š ========== */
let exp=0, level=1;
function addEXP(amount){
  exp+=amount;
  checkLevelUp();
  updateLevelUI();
}
function checkLevelUp(){
  let needed=level*50;
  while(exp>=needed){
    exp-=needed;
    level++;
    playDing('level');
    checkAchievements('level');
    needed=level*50;
    chickLevelUp();
  }
}
function updateLevelUI(){
  let percent=(exp/(level*50))*100;
  document.getElementById("levelProgress").style.width=percent+"%";
  document.getElementById("levelText").textContent="Lv."+level+" å†’éšªè€…";
}

/* ========== å°é›å‡ç´šå‹•ç•« 10 éš ========== */
function chickLevelUp(){
  const chick=document.getElementById("chickContainer");
  chick.classList.add("chick-glow");
  setTimeout(()=>{chick.classList.remove("chick-glow");},1000);
  const svg=chick.querySelector(".chick-svg");
  let extra='';
  if(level>=2) extra+='<polygon points="100,60 90,50 110,50" fill="#AAFF00"/>';
  if(level>=3) extra+='<polygon points="100,50 85,30 115,30" fill="#FFD700"/>';
  if(level>=4) extra+='<polygon points="100,40 80,20 120,20" fill="#FFD700"/><polygon points="90,150 110,150 100,180" fill="#00BFFF"/>';
  if(level>=5) extra+='<polygon points="100,30 70,10 130,10" fill="#FF69B4"/>';
  if(level>=6) extra+='<polygon points="50,150 150,150 100,190" fill="#00FF7F"/>';
  if(level>=7) extra+='<polygon points="100,20 60,0 140,0" fill="#FF4500"/>';
  if(level>=8) extra+='<polygon points="30,140 170,140 100,200" fill="#8A2BE2"/>';
  if(level>=9) extra+='<polygon points="100,10 40,0 160,0" fill="#00CED1"/>';
  if(level>=10) extra+='<polygon points="20,130 180,130 100,210" fill="#FFD700"/>';
  svg.innerHTML='<circle cx="100" cy="120" r="50" fill="#FFEB3B"/>'+
                '<circle cx="80" cy="100" r="10"/><circle cx="120" cy="100" r="10"/>'+
                '<polygon points="100,115 90,130 110,130" fill="#FF9800"/>'+
                '<polygon points="60,160 70,140 80,160" fill="#FF9800"/>'+
                '<polygon points="140,160 130,140 120,160" fill="#FF9800"/>'+extra;
}

/* ========== æˆå°±ç³»çµ± ========== */
const titles = [
 "å†’éšªæ–°æ‰‹","å°ˆæ³¨å­¸å¾’","çŸ¥è­˜å‹‡è€…","å°é›å¤§å¸«","å‚³èªªå­¸è€…"
];
document.getElementById("levelText").textContent =
  `Lv.${level} ${titles[Math.min(level-1, titles.length-1)]}`;
let players[currentPlayer].pomodoroCount = pomodoroCount;
function checkAchievements(type){
  if(type==='level' && level>=5 && !achievements.level5.unlocked){ unlockAchievement('level5'); }
  if(type==='level' && level>=10 && !achievements.level10.unlocked){ unlockAchievement('level10'); }
  if(type==='pomodoro'){ pomodoroCount++; if(pomodoroCount>=5 && !achievements.pomodoro5.unlocked){ unlockAchievement('pomodoro5'); } }
}
function unlockAchievement(key){
  achievements[key].unlocked=true;
  showAchievementPopup(achievements[key].name);
  playDing('achievement');
}
function showAchievementPopup(name){
  const div=document.createElement("div");
  div.className="achievement-popup";
  div.textContent=`ğŸ† æˆå°±è§£é–ï¼š${name}`;
  document.body.appendChild(div);
  setTimeout(()=>{div.remove();},1500);
}

/* ========== Chart.js è®€æ›¸ç´€éŒ„ ========== */
const studyData=[0,0,0,0,0,0,0];
const studyChart=new Chart(document.getElementById("studyChart"),{
  type:'line',
  data:{
    labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
    datasets:[{
      label:"è®€æ›¸æ™‚é–“(å°æ™‚)",
      data:studyData,
      borderColor:"#ff8bb5",
      backgroundColor:"#ffbcd9",
      tension:0.3
    }]
  },
  options: {
  scales: {
    x: {
      ticks: {
        color: darkMode ? "#fff" : "#000"
      }
    },
    y: {
      beginAtZero: true,
      ticks: {
        color: darkMode ? "#fff" : "#000"
      }
    }
  }
  }
});
function addStudyTime(hours){
  const day=new Date().getDay(); //0=Sun
  const index=(day==0?6:day-1);
  studyData[index]+=hours;
  studyChart.data.datasets[0].data=studyData;
  studyChart.update();
  document.getElementById("todayTime").textContent=studyData[index]+" å°æ™‚";
}

/* ========== å°æ¸¬é©— ========== */
const quizQuestions=[
  {q:"ä»Šå¤©ä½ å­¸ç¿’çš„å¿ƒæƒ…ï¼Ÿ", a:["å°ˆæ³¨","ç´¯","ç²¾ç¥"]},
  {q:"ä½ å–œæ­¡å“ªç¨®å°é›å¸½å­ï¼Ÿ", a:["çš‡å† ","æ³•å¸«å¸½","å†’éšªå¸½"]},
  {q:"å¦‚æœé‡åˆ°å›°é›£ï¼Œä½ æœƒï¼Ÿ", a:["åŠªåŠ›è§£æ±º","ä¼‘æ¯","æ‰¾æœ‹å‹"]},
  {q:"å­¸ç¿’ç’°å¢ƒä½ åå¥½ï¼Ÿ", a:["å®‰éœ","éŸ³æ¨‚","ç†±é¬§"]},
  {q:"ä½ è¦ºå¾—è‡ªå·±åƒå“ªéš»å°é›ï¼Ÿ", a:["å‘†èŒ","å‹‡æ•¢","èª¿çš®"]}
];
let quizAnswers = [];
let quizIndex=0;
function showQuiz(){
  const q=quizQuestions[quizIndex];
  document.getElementById("quizQuestion").textContent=q.q;
  const options=document.getElementById("quizOptions");
  options.innerHTML="";
  q.a.forEach(opt=>{
    const b=document.createElement("button");
    b.className="btn";
    b.textContent=opt;
    b.onclick = () => selectAnswer(opt);
    options.appendChild(b);
  });
}
function nextQuiz(){
  quizIndex++;
  if(quizIndex<quizQuestions.length){showQuiz();}
  else{
  const result = calculateQuizResult();
  document.getElementById("quizResult").textContent =
    `ğŸ¥ ä½ çš„æ€§æ ¼æ˜¯ã€${result}ã€‘`;
  }

showQuiz();
function selectAnswer(answer){
  quizAnswers.push(answer);
  nextQuiz();
}
function calculateQuizResult(){
  let score = { 
    å‹‡æ•¢:0, 
    å‘†èŒ:0, 
    å†·éœ:0 
  };

  quizAnswers.forEach(a=>{
    if(a==="åŠªåŠ›è§£æ±º" || a==="å‹‡æ•¢" || a==="å†’éšªå¸½"){
      score.å‹‡æ•¢++;
    }
    if(a==="å‘†èŒ" || a==="ä¼‘æ¯"){
      score.å‘†èŒ++;
    }
    if(a==="å°ˆæ³¨" || a==="å®‰éœ" || a==="éŸ³æ¨‚"){
      score.å†·éœ++;
    }
  });

  let maxType = "å‹‡æ•¢";
  for(const k in score){
    if(score[k] > score[maxType]) maxType = k;
  }

  return maxType + "å°é›";
}

/* ========== æ’è¡Œæ¦œ + åŒ¿ååˆ†äº«ç¢¼ + æœ¬åœ°å„²å­˜ ========== */
let players={};
let currentPlayer=null;

function loadPlayers(){ 
  const data=localStorage.getItem("players");
  if(data) players=JSON.parse(data);
}
function savePlayers(){ 
  localStorage.setItem("players", JSON.stringify(players));
}
function savePlayerData(){
  if(!currentPlayer) return;
  players[currentPlayer].level=level;
  players[currentPlayer].exp=exp;
  players[currentPlayer].study=studyData;
  players[currentPlayer].achievements=achievements;
  savePlayers();
  updateLeaderboard();
}

function genShareCode(){return Math.random().toString(36).substr(2,6);}
function loginPlayer(){
  const name=document.getElementById("playerName").value.trim();
  if(!name) return;
  loadPlayers();
  if(!players[name]) players[name]={level:1,exp:0,study:[0,0,0,0,0,0,0],shareCode:genShareCode(),achievements:{}};
  currentPlayer=name;

  // è¼‰å…¥ç©å®¶è³‡æ–™
  const p=players[name];
  level=p.level; exp=p.exp;
  updateLevelUI();
  for(let i=0;i<7;i++){ studyData[i]=p.study[i]||0; }
  studyChart.data.datasets[0].data=studyData; studyChart.update();
  pomodoroCount=0;
  for (const k in achievements) {
  achievements[k].unlocked = p.achievements?.[k]?.unlocked || false;
  }
  document.getElementById("todayTime").textContent=studyData[(new Date().getDay()==0?6:new Date().getDay()-1)]+" å°æ™‚";

  document.getElementById("shareCode").textContent=p.shareCode;
  savePlayers();
  updateLeaderboard();
}

function loadByShareCode(){
  const code=document.getElementById("shareCodeInput").value.trim();
  for(const name in players){ if(players[name].shareCode===code){
    alert("ç©å®¶ "+name+" Lv."+players[name].level+" EXP:"+players[name].exp);
    return;
  }}
  alert("æ‰¾ä¸åˆ°è©²åˆ†äº«ç¢¼ç©å®¶");
}

function updateLeaderboard(){
  const ul=document.getElementById("leaderboardList");
  ul.innerHTML="";
  const arr=Object.entries(players).sort((a,b)=>b[1].level*100+b[1].exp - (a[1].level*100+a[1].exp));
  arr.forEach(([name,data],i)=>{
    const li=document.createElement("li");
    li.textContent=`${i+1}. ${name} Lv.${data.level} EXP:${data.exp}`;

    if(name === currentPlayer){
      li.style.fontWeight = "bold";
    }
    ul.appendChild(li);
  });
}

// åˆå§‹
loadPlayers();
updateLeaderboard();

</script>
</body>
</html>
