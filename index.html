<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Programï½œç‹è€…ç‰ˆ</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ================= å…¨åŸŸæ¨£å¼ ================= */
body{
  margin:0;
  font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
  font-size: 18px;              /* â­ æ•´é«”å­—è®Šå¤§ */
  line-height: 1.6;             /* â­ è€å¸«çœ‹å¾—å¾ˆèˆ’æœ */
  background: linear-gradient(#ffe6f7,#d6e8ff);
  text-align:center;
  transition:.3s;
}

.btn{
  padding:10px 16px;
  border:none;
  border-radius:14px;
  background:#ffb8d1;
  cursor:pointer;
  margin:5px;
}
.card{
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin:15px;
  display:inline-block;
  width:280px;
}
.section{display:none}

/* å°é›æ¼‚æµ® */
@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
  100%{transform:translateY(0)}
}
.chick-container{
  width:200px;
  margin:auto;
  animation:float 3s infinite;
}
/* ================= æ·±è‰²æ¨¡å¼ ================= */
body.dark{
  background: linear-gradient(#1e1e1e,#2c2c2c);
  color:#f5f5f5;
}

body.dark .card{
  background:#3a3a3a;
}

body.dark .btn{
  background:#555;
  color:#fff;
}

body.dark input{
  background:#555;
  color:#fff;
  border:none;
}
/* ================= ğŸŒ™ æ·±è‰²æ¨¡å¼ï½œç‹è€…ç´šé…è‰² ================= */
body.dark{
  background: linear-gradient(160deg,#0f2027,#203a43,#2c5364);
  color:#eaeaea;
}

/* å°è¦½æŒ‰éˆ• */
body.dark .btn{
  background: linear-gradient(145deg,#3a3a3a,#2a2a2a);
  color:#fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.6);
}
body.dark .btn:hover{
  transform: translateY(-2px);
  background: linear-gradient(145deg,#444,#333);
}

/* å¡ç‰‡ */
body.dark .card{
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
}

/* è¼¸å…¥æ¡† */
body.dark input{
  background:#1f2933;
  color:#fff;
  border:1px solid #3a4a5a;
}

/* æ¨™é¡Œ */
body.dark h1,
body.dark h2,
body.dark h3{
  color:#ffffff;
}

/* åˆ†éš”ç·š */
body.dark hr{
  border-color: rgba(255,255,255,0.2);
}

/* ğŸŒŸ å°é›å¾®å…‰ï¼ˆæ·±è‰²æ¨¡å¼é™å®šï¼‰ */
body.dark .chick-container{
  filter: drop-shadow(0 0 12px rgba(255,255,180,0.6));
}
/* ================= ğŸ¥ æ·±è‰²æ¨¡å¼é™å®šï½œå°é›é€²åŒ–ç‰¹æ•ˆ ================= */

/* é€²åŒ–å‘¼å¸å‹•ç•« */
@keyframes evolvePulse{
  0%{
    transform: scale(1);
    filter: drop-shadow(0 0 6px rgba(255,255,180,0.4));
  }
  50%{
    transform: scale(1.12);
    filter: drop-shadow(0 0 22px rgba(255,255,200,0.9));
  }
  100%{
    transform: scale(1);
    filter: drop-shadow(0 0 6px rgba(255,255,180,0.4));
  }
}

/* æ·±è‰²æ¨¡å¼æ‰å•Ÿå‹• */
body.dark .chick-container{
  animation: evolvePulse 3s ease-in-out infinite;
  position: relative;
}

/* ç²’å­å…‰é» */
body.dark .chick-container::after{
  content:"âœ¨ âœ¦ âœ§ âœ¨";
  position:absolute;
  top:-20px;
  left:50%;
  transform:translateX(-50%);
  font-size:20px;
  opacity:0.8;
  animation: sparkle 2s infinite alternate;
}

@keyframes sparkle{
  from{
    opacity:0.3;
    transform:translateX(-50%) translateY(0);
  }
  to{
    opacity:1;
    transform:translateX(-50%) translateY(-8px);
  }
}
/* ================= ğŸ¨ æ·±è‰²æ¨¡å¼ï½œå°é›æ€§æ ¼å…‰è‰² ================= */

/* é è¨­å…‰ */
body.dark .chick-container{
  --glow: rgba(255,255,200,0.6);
}

/* å‹‡æ•¢å°é› â†’ é‡‘å…‰ */
body.dark .chick-container.brave{
  --glow: rgba(255,215,0,0.9);
}

/* å†·éœå°é› â†’ è—å…‰ */
body.dark .chick-container.calm{
  --glow: rgba(100,180,255,0.9);
}

/* å‘†èŒå°é› â†’ ç²‰å…‰ */
body.dark .chick-container.cute{
  --glow: rgba(255,150,200,0.9);
}

/* å¥—ç”¨å…‰è‰² */
body.dark .chick-container{
  filter: drop-shadow(0 0 18px var(--glow));
}


</style>
</head>

<body>

<h1>ğŸ¥ Study Program</h1>

<!-- å°è¦½ -->
<div>
  <button class="btn" onclick="UI.show('home')">é¦–é </button>
  <button class="btn" onclick="UI.show('pomodoro')">ç•ªèŒ„é˜</button>
  <button class="btn" onclick="UI.show('quiz')">å°æ¸¬é©—</button>
  <button class="btn" onclick="UI.show('chart')">æ•¸æ“š</button>
  <button class="btn" onclick="UI.show('leaderboard')">æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="UI.toggleDark()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
</div>

<!-- ================= é¦–é  ================= -->
<section id="home" class="section" style="display:block">
  <div class="chick-container">ğŸ¥</div>

  <div class="card">
    <h3>ç­‰ç´š</h3>
    <p id="levelText">Lv.1</p>
  </div>

  <div class="card">
    <h3>ä»Šæ—¥è®€æ›¸</h3>
    <p id="todayTime">0 å°æ™‚</p>
  </div>

  <div class="card">
    <h3>å°é›æ€§æ ¼</h3>
    <p id="chickPersonalityText">å°šæœªæ¸¬é©—</p>
  </div>
</section>

<!-- ================= ç•ªèŒ„é˜ ================= -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <h3 id="pomodoroMode">ğŸ¯ å°ˆæ³¨ä¸­</h3>

  <div id="timer" style="font-size:40px;margin:15px">25:00</div>

  <button class="btn" onclick="Pomodoro.start()">â–¶ é–‹å§‹</button>
  <button class="btn" onclick="Pomodoro.pause()">â¸ æš«åœ</button>
  <button class="btn" onclick="Pomodoro.reset()">ğŸ”„ é‡è¨­</button>
</section>

<!-- ================= å°æ¸¬é©— ================= -->
<section id="quiz" class="section">
  <div class="card">
    <h3>ğŸ¥ å°é›æ€§æ ¼æ¸¬é©—</h3>

    <p id="quizProgress"></p>
    <p id="quizQ"></p>

    <div id="quizOpt"></div>

    <button class="btn" onclick="Quiz.next()" style="display:none" id="nextBtn">
      ä¸‹ä¸€é¡Œ
    </button>

    <p id="quizResult" style="font-weight:bold;margin-top:10px;"></p>

    <button class="btn" onclick="Quiz.reset()" style="display:none" id="retryBtn">
      å†ç©ä¸€æ¬¡
    </button>
  </div>
</section>

<!-- ================= åœ–è¡¨ ================= -->
<section id="chart" class="section">
  <canvas id="studyChart" width="300"></canvas>
</section>

<!-- ================= æ’è¡Œæ¦œ ================= -->
<section id="leaderboard" class="section">
  <div class="card">
    <h3>ğŸ‘¤ ç©å®¶ç™»å…¥</h3>
    <input id="playerName" placeholder="è¼¸å…¥åç¨±">
    <button class="btn" onclick="Player.login()">ç™»å…¥</button>

    <p style="margin-top:10px;">
      ğŸ”‘ æˆ‘çš„åˆ†äº«ç¢¼ï¼š
      <strong id="shareCodeText">å°šæœªç™»å…¥</strong>
    </p>

    <hr>

    <h3>ğŸ” ç”¨åˆ†äº«ç¢¼æŸ¥è©¢</h3>
    <input id="searchCode" placeholder="è¼¸å…¥åˆ†äº«ç¢¼">
    <button class="btn" onclick="Player.searchByCode()">æŸ¥è©¢</button>

    <p id="searchResult"></p>

    <hr>

    <h3>ğŸ† æ’è¡Œæ¦œ</h3>
    <ul id="rank"></ul>
  </div>
</section>

<script>

/* ================= è³‡æ–™ä¿å­˜ ================= */
function saveGame(){
  localStorage.setItem("studyGame", JSON.stringify(State));
}

function loadGame(){
  const data = localStorage.getItem("studyGame");
  if(data){
    Object.assign(State, JSON.parse(data));
  }
}
/* ================= ç‹€æ…‹ç®¡ç†ï¼ˆæ ¸å¿ƒï¼‰ ================= */
const State = {
  level:1,
  exp:0,
  study:[0,0,0,0,0,0,0],
  chickPersonality:"",
  currentPlayer:null,
  players:{},
  dark:false
};

/* ================= UI ================= */
const UI = {
  show(id){
    document.querySelectorAll(".section").forEach(s=>s.style.display="none");
    document.getElementById(id).style.display="block";
  },
  toggleDark(){
  State.dark = !State.dark;
  document.body.classList.toggle("dark", State.dark);
}
};
/* ================= å‡ç´šç³»çµ± ================= */
const LevelSystem = {
  addExp(amount){
    State.exp += amount;
    let need = State.level * 50;
    let up = false;

    while(State.exp >= need){
      State.exp -= need;
      State.level++;
      need = State.level * 50;
      up = true;
    }

    if(up){
      const chick = document.querySelector(".chick-container");
      chick.classList.add("evolve");
      setTimeout(()=>chick.classList.remove("evolve"),1500);
      alert(`â¬†ï¸ å‡ç´šæˆåŠŸï¼Lv.${State.level}`);
    }

    UI.update();
    saveGame();
  }
};
/* ================= ç©å®¶ ================= */
const Player = {
  login(){
    const name = document.getElementById("playerName").value.trim();
    if(!name) return;

    // åˆå§‹åŒ–ç©å®¶
    if(!State.players[name]){
      State.players[name] = {
        level: 1,
        study: [0,0,0,0,0,0,0],
        chickPersonality: "",
        shareCode: Math.random().toString(36).slice(2,8)
      };
    }

    State.currentPlayer = name;

    // å°‡ç©å®¶è³‡æ–™åŒæ­¥åˆ° State
    Object.assign(State, State.players[name]);

    UI.update();
    Player.updateShareCode();
    Player.updateLeaderboard();
  },

  updateShareCode(){
    const el = document.getElementById("shareCodeText");
    if(!State.currentPlayer){
      el.textContent = "å°šæœªç™»å…¥";
    }else{
      el.textContent = State.players[State.currentPlayer].shareCode;
    }
  },

  searchByCode(){
    const code = document.getElementById("searchCode").value.trim();
    const result = document.getElementById("searchResult");
    result.textContent = "";

    if(!code) return;

    for(const name in State.players){
      if(State.players[name].shareCode === code){
        result.textContent = `æ‰¾åˆ°ç©å®¶ï¼š${name}ï¼ˆLv.${State.players[name].level}ï¼‰`;
        return;
      }
    }

    result.textContent = "âŒ æ‰¾ä¸åˆ°æ­¤åˆ†äº«ç¢¼";
  },

  updateLeaderboard(){
    const ul = document.getElementById("rank");
    ul.innerHTML = "";

    const list = Object.entries(State.players);

    list.forEach(([name,data])=>{
      const li = document.createElement("li");
      li.textContent = `${name} ï½œ Lv.${data.level}`;
      if(name === State.currentPlayer){
        li.style.fontWeight = "bold";
      }
      ul.appendChild(li);
    });
  }
};


/* ================= UI æ›´æ–° ================= */
function updateChickPersonalityUI(){
  const chick = document.querySelector(".chick-container");
  const text = document.getElementById("chickPersonalityText");

  // æ¸…ç©ºèˆŠç‹€æ…‹
  chick.classList.remove("brave","calm","cute");

  if(!State.chickPersonality){
    text.textContent = "å°šæœªæ¸¬é©—";
    return;
  }

  text.textContent = State.chickPersonality;

  if(State.chickPersonality === "å‹‡æ•¢"){
    chick.classList.add("brave");
  }else if(State.chickPersonality === "å†·éœ"){
    chick.classList.add("calm");
  }else if(State.chickPersonality === "å‘†èŒ"){
    chick.classList.add("cute");
  }
}

UI.update = ()=>{
  document.getElementById("levelText").textContent = "Lv."+State.level;
  document.getElementById("todayTime").textContent =
    State.study[new Date().getDay()||6]+" å°æ™‚";

  updateChickPersonalityUI(); // â­ é—œéµé€£æ¥ç·š

  Player.updateShareCode();
};


/* ================= ğŸ… ç•ªèŒ„é˜ï½œç‹è€…æœ€çµ‚å‹ ================= */
const Pomodoro = {
  mode: "focus",
  durations: {
    focus: 25 * 60,
    short: 5 * 60,
    long: 15 * 60
  },
  time: 25 * 60,
  timerId: null,
  running: false,
  streak: 0,
  total: 0,

  start(){
    if(this.running) return;
    this.running = true;

    this.timerId = setInterval(()=>{
      this.time--;

      if(this.time <= 3 && this.time > 0) this.beep();
      if(this.time <= 0){
        this.finish();
        return;
      }
      this.update();
    },1000);
  },

  pause(){
    clearInterval(this.timerId);
    this.running = false;
  },

  reset(){
    clearInterval(this.timerId);
    this.running = false;
    this.streak = 0;
    this.setMode("focus");
  },

  finish(){
    clearInterval(this.timerId);
    this.running = false;

    if(this.mode === "focus"){
      this.total++;
      this.streak++;

      Level.addExp(25);
      Achievement.check(this.total);
      State.study[new Date().getDay() || 6] += 0.5;

      this.evolveChick();

      if(this.streak % 4 === 0){
        this.setMode("long");
        alert("ğŸ”¥ 4 é¡†ç•ªèŒ„å®Œæˆï¼é€²å…¥é•·ä¼‘æ¯");
      }else{
        this.setMode("short");
        alert("âœ… å°ˆæ³¨å®Œæˆï¼ŒçŸ­ä¼‘æ¯ï¼");
      }
    }else{
      this.setMode("focus");
      alert("ğŸ’ª å›åˆ°å°ˆæ³¨ï¼");
    }

    saveGame();
  },

  setMode(mode){
    this.mode = mode;
    this.time = this.durations[mode];
    this.update();
    document.getElementById("pomodoroMode").textContent =
      mode==="focus"?"ğŸ¯ å°ˆæ³¨ä¸­":mode==="short"?"â˜• çŸ­ä¼‘æ¯":"ğŸ›Œ é•·ä¼‘æ¯";
  },

  update(){
    const m = Math.floor(this.time/60);
    const s = this.time%60;
    document.getElementById("timer").textContent =
      `${m}:${String(s).padStart(2,"0")}`;
  },

  beep(){
    const a = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
    a.volume = 0.3;
    a.play();
  },

  evolveChick(){
    const chick = document.querySelector(".chick-container");
    chick.classList.add("brave");
    setTimeout(()=>chick.classList.remove("brave"),2000);
  }
};
const Level = {
  exp: 0,
  level: 1,

  addExp(amount){
    this.exp += amount;
    if(this.exp >= 100){
      this.exp -= 100;
      this.level++;
      State.level = this.level;
      alert("ğŸ‰ å‡ç´šäº†ï¼Lv." + this.level);
    }
    UI.update();
  }
};
const Achievement = {
  milestones: [10,25,50],

  check(total){
    this.milestones.forEach(m=>{
      if(total === m){
        alert(`ğŸ† æˆå°±è§£é–ï¼šå®Œæˆ ${m} é¡†ç•ªèŒ„ï¼`);
      }
    });
  }
};
/* ================= å°æ¸¬é©— ================= */
const Quiz = {
  i:0,
  answers:[],

  q:[
    {q:"ä»Šå¤©çš„å­¸ç¿’ç‹€æ…‹ï¼Ÿ",a:["è¶…å°ˆæ³¨","æœ‰é»ç´¯","å¿ƒä¸åœ¨ç„‰"]},
    {q:"é‡åˆ°é›£é¡Œä½ æœƒï¼Ÿ",a:["æ’å®Œ","ä¼‘æ¯","æ‰¾æœ‹å‹"]},
    {q:"ä½ åƒå“ªéš»å°é›ï¼Ÿ",a:["å‹‡æ•¢","å†·éœ","å‘†èŒ"]}
  ],

  show(){
    document.getElementById("quizQ").textContent=this.q[this.i].q;
    const o=document.getElementById("quizOpt");
    o.innerHTML="";
    this.q[this.i].a.forEach(t=>{
      const b=document.createElement("button");
      b.className="btn";
      b.textContent=t;
      b.onclick=()=>{
        this.answers[this.i]=t;
        this.next();
      };
      o.appendChild(b);
    });
  },

  next(){
    this.i++;
    if(this.i<this.q.length){
      this.show();
    }else{
      this.finish();
    }
  },

  finish(){
    let score={å‹‡æ•¢:0,å†·éœ:0,å‘†èŒ:0};
    this.answers.forEach(a=>{
      if(a==="å‹‡æ•¢"||a==="æ’å®Œ") score.å‹‡æ•¢++;
      if(a==="å†·éœ") score.å†·éœ++;
      if(a==="å‘†èŒ"||a==="ä¼‘æ¯") score.å‘†èŒ++;
    });

    let type="å‹‡æ•¢";
    for(let k in score){
      if(score[k]>score[type]) type=k;
    }

    State.chickPersonality=type;
    document.getElementById("quizQ").textContent=`ğŸ‰ ä½ æ˜¯ã€${type}å°é›ã€‘`;
    document.getElementById("quizOpt").innerHTML="";

    LevelSystem.addExp(30);
    UI.update();
    saveGame();
  }
};

Quiz.show();
/* ================= åœ–è¡¨ ================= */
new Chart(document.getElementById("studyChart"),{
  type:"line",
  data:{
    labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
    datasets:[{data:State.study}]
  }
});
loadGame();
UI.update();
Quiz.show();
function saveGame(){
  localStorage.setItem("studyGame", JSON.stringify({
    state: State,
    level: Level,
    pomodoroTotal: Pomodoro.total
  }));
}

function loadGame(){
  const data = JSON.parse(localStorage.getItem("studyGame"));
  if(!data) return;
  Object.assign(State, data.state);
  Level.level = data.level.level;
  Level.exp = data.level.exp;
  Pomodoro.total = data.pomodoroTotal || 0;
  UI.update();
}

loadGame();
</script>

</body>
</html>
