<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Galaxy RPG å°é›å†’éšªç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {margin:0; padding:0; font-family:"Microsoft JhengHei",sans-serif; background: linear-gradient(#ffe6f7,#d6e8ff); text-align:center; transition: all 0.5s; color:#000;}
.btn{padding:10px 15px; margin:5px; border:none; border-radius:12px; background:#ffb8d1; font-size:16px; cursor:pointer; transition:0.3s;}
.btn:hover{background:#ff95be;transform:scale(1.05);}
.card{display:inline-block; background:white; padding:20px; margin:15px; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.15); width:280px; transition:0.3s;}
.card:hover{transform:scale(1.05);}
.level-bar{width:80%; height:20px; background:#fff; border-radius:10px; margin:10px auto; overflow:hidden; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);}
.level-progress{height:100%; background: linear-gradient(90deg,#ff95be,#ffb8d1); width:0%; transition: width 0.5s;}
.chick-container{width:200px; margin:15px auto; transition: all 0.5s;}
.chick-svg{width:100%;height:auto;}
.chick-glow{filter: drop-shadow(0 0 20px yellow); transform: scale(1.2);}
.chat-input{width:70%; padding:8px; border-radius:10px; border:1px solid #ccc; margin-right:5px;}
.section{display:none;}
</style>
</head>
<body>

<h1>ğŸŒŸ Study Galaxy â€“ RPG å°é›å†’éšªç‰ˆ</h1>
<p>å°é›åŠ©æ•™é™ªä½ å­¸ç¿’å†’éšªï¼</p>

<div>
  <button class="btn" id="btnHome">ğŸ  é¦–é </button>
  <button class="btn" id="btnPomodoro">ğŸ… ç•ªèŒ„é˜</button>
  <button class="btn" id="btnQuiz">ğŸ® å°æ¸¬é©—</button>
  <button class="btn" id="btnAI">âœ¨ AI å°è€å¸«</button>
  <button class="btn" id="btnChart">ğŸ“Š è®€æ›¸æ•¸æ“š</button>
  <button class="btn" id="btnDark">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
</div>

<hr style="opacity:0.3; width:80%; margin:20px auto;">

<!-- é¦–é  -->
<section id="home" class="section" style="display:block;">
  <div class="card">
    <h2>ä»Šæ—¥è®€æ›¸æ™‚é–“</h2>
    <p id="todayTime">0 å°æ™‚</p>
  </div>
  <div class="card">
    <h2>å‡ç´šé€²åº¦</h2>
    <div class="level-bar"><div id="levelProgress" class="level-progress"></div></div>
    <p id="levelText">Lv.1 å†’éšªæ–°æ‰‹</p>
  </div>
  <div class="chick-container" id="chickContainer">
    <svg class="chick-svg" viewBox="0 0 200 200">
      <circle cx="100" cy="120" r="50" fill="#FFEB3B"/>
      <circle cx="80" cy="100" r="10"/>
      <circle cx="120" cy="100" r="10"/>
      <polygon points="100,115 90,130 110,130" fill="#FF9800"/>
      <polygon points="60,160 70,140 80,160" fill="#FF9800"/>
      <polygon points="140,160 130,140 120,160" fill="#FF9800"/>
    </svg>
  </div>
  <div class="card">
    <h2>ğŸ† æ’è¡Œæ¦œ</h2>
    <ul id="leaderboard" style="text-align:left; list-style:none; padding-left:0;"></ul>
  </div>
</section>

<!-- ç•ªèŒ„é˜ -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div style="font-size:48px; margin:20px;" id="timerDisplay">25:00</div>
  <button class="btn" id="startTimerBtn">â–¶ é–‹å§‹</button>
  <button class="btn" id="resetTimerBtn">ğŸ”„ é‡è¨­</button>
</section>

<!-- å°æ¸¬é©— -->
<section id="quiz" class="section">
  <h2>ğŸ® RPG å°é›å°æ¸¬é©—</h2>
  <div class="card" style="max-width:400px; margin:auto;">
    <p id="quizQuestion">Loading...</p>
    <div id="quizOptions"></div>
    <h3 id="quizResult" style="margin-top:20px;"></h3>
  </div>
</section>

<!-- æ¨¡æ“¬ AI å°è€å¸« -->
<section id="ai" class="section">
  <h2>âœ¨ AI å°è€å¸«</h2>
  <div class="card" style="max-width:500px; margin:auto;">
    <div class="chat-log" id="chatLog" style="height:220px; overflow-y:auto; background:#f6f6f6; padding:10px; border-radius:10px; margin-bottom:12px;"></div>
    <input id="chatInput" class="chat-input" placeholder="è¼¸å…¥ä½ çš„å•é¡Œâ€¦">
    <button class="btn" id="sendAI">é€å‡º</button>
  </div>
</section>

<!-- è®€æ›¸ç´€éŒ„ -->
<section id="chart" class="section">
  <h2>ğŸ“Š æˆ‘çš„è®€æ›¸ç´€éŒ„</h2>
  <canvas id="studyChart" width="350"></canvas>
</section>

<script>
window.addEventListener('DOMContentLoaded', () => {
  /* -------------------- é€šç”¨ -------------------- */
  function showSection(id){
    document.querySelectorAll(".section").forEach(s=>s.style.display="none");
    document.getElementById(id).style.display="block";
  }
  document.getElementById("btnHome").addEventListener("click",()=>showSection("home"));
  document.getElementById("btnPomodoro").addEventListener("click",()=>showSection("pomodoro"));
  document.getElementById("btnQuiz").addEventListener("click",()=>showSection("quiz"));
  document.getElementById("btnAI").addEventListener("click",()=>showSection("ai"));
  document.getElementById("btnChart").addEventListener("click",()=>showSection("chart"));

  let darkMode=false;
  document.getElementById("btnDark").addEventListener("click", ()=>{
    darkMode = !darkMode;
    if(darkMode){
      document.body.style.background="linear-gradient(#1c1c1c,#333)";
      document.body.style.color="#fff";
    } else {
      document.body.style.background="linear-gradient(#ffe6f7,#d6e8ff)";
      document.body.style.color="#000";
    }
  });

  /* -------------------- ç©å®¶åç¨± -------------------- */
  let playerName = prompt("è«‹è¼¸å…¥ä½ çš„åå­—ï¼š", "å°é›å†’éšªè€…") || "å°é›å†’éšªè€…";

  /* -------------------- éŸ³æ•ˆ -------------------- */
  function playDing(type){
    let url="";
    if(type==="level") url="https://freesound.org/data/previews/341/341695_62467-lq.mp3";
    else if(type==="pomodoro") url="https://freesound.org/data/previews/341/341695_62467-lq.mp3";
    else if(type==="achievement") url="https://freesound.org/data/previews/331/331912_3248244-lq.mp3";
    if(url){const audio=new Audio(url); audio.play();}
  }

  /* -------------------- EXP / å‡ç´š / å°é›é€²åŒ– -------------------- */
  let exp=localStorage.getItem("exp")?parseInt(localStorage.getItem("exp")):0;
  let level=localStorage.getItem("level")?parseInt(localStorage.getItem("level")):1;

  function addEXP(amount){
    exp+=amount;
    localStorage.setItem("exp", exp);
    checkLevelUp();
    updateLevelUI();
    updateLeaderboard();
  }

  function checkLevelUp(){
    let needed = level*50;
    while(exp >= needed){
      exp -= needed;
      level++;
      localStorage.setItem("level", level);
      needed = level*50;
      chickLevelUp();
      playDing('level');
      checkAchievements();
    }
  }

  function updateLevelUI(){
    let percent = (exp/(level*50))*100;
    document.getElementById("levelProgress").style.width = percent+"%";
    document.getElementById("levelText").textContent = "Lv."+level+" å†’éšªè€…";
  }

  function chickLevelUp(){
    const chick = document.getElementById("chickContainer");
    chick.classList.add("chick-glow");
    setTimeout(()=>{chick.classList.remove("chick-glow");},1000);
    const svg = chick.querySelector(".chick-svg");
    let body = '<circle cx="100" cy="120" r="50" fill="#FFEB3B"/>';
    let eyes = '<circle cx="80" cy="100" r="10"/><circle cx="120" cy="100" r="10"/>';
    let beak = '<polygon points="100,115 90,130 110,130" fill="#FF9800"/>';
    let feet = '<polygon points="60,160 70,140 80,160" fill="#FF9800"/><polygon points="140,160 130,140 120,160" fill="#FF9800"/>';
    let extras = '';
    if(level>=2) extras+='<polygon points="100,60 90,50 110,50" fill="#AAFF00"/>';
    if(level>=3) extras+='<polygon points="100,50 85,30 115,30" fill="#FFD700"/>';
    if(level>=4) extras+='<polygon points="100,40 80,20 120,20" fill="#FFD700"/><polygon points="90,150 110,150 100,180" fill="#00BFFF"/>';
    if(level>=5) extras+='<polygon points="50,50 70,30 90,50" fill="#FF69B4"/>';
    if(level>=6) extras+='<polygon points="110,50 130,30 150,50" fill="#FF69B4"/>';
    if(level>=7) extras+='<polygon points="100,10 85,0 115,0" fill="#FFD700"/>';
    if(level>=8) extras+='<polygon points="40,130 60,110 80,130" fill="#00FFFF"/>';
    if(level>=9) extras+='<polygon points="120,130 140,110 160,130" fill="#00FFFF"/>';
    if(level>=10) extras+='<polygon points="100,5 80,-15 120,-15" fill="#FF4500"/>';
    svg.innerHTML = body+eyes+beak+feet+extras;
  }

  /* -------------------- æˆå°±ç³»çµ± -------------------- */
  let achievements = JSON.parse(localStorage.getItem("achievements")||"[]");
  function checkAchievements(){
    if(level>=5 && !achievements.includes("å‹‡è€…å°é›")){
      achievements.push("å‹‡è€…å°é›"); alert("æˆå°±è§£é– ğŸ† å‹‡è€…å°é›ï¼"); playDing('achievement'); localStorage.setItem("achievements",JSON.stringify(achievements));
    }
    if(level>=10 && !achievements.includes("å‚³èªªå°é›")){
      achievements.push("å‚³èªªå°é›"); alert("æˆå°±è§£é– ğŸ† å‚³èªªå°é›ï¼"); playDing('achievement'); localStorage.setItem("achievements",JSON.stringify(achievements));
    }
  }

  /* -------------------- ç•ªèŒ„é˜ -------------------- */
  let timer = 25*60, timerInterval;
  const timerDisplay = document.getElementById("timerDisplay");
  document.getElementById("startTimerBtn").addEventListener("click", startTimer);
  document.getElementById("resetTimerBtn").addEventListener("click", resetTimer);

  function updateTimerDisplay(){
    let m=Math.floor(timer/60), s=timer%60;
    timerDisplay.textContent = (m<10?"0":"")+m+":"+(s<10?"0":"")+s;
  }

  function startTimer(){
    clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
      if(timer<=0){
        clearInterval(timerInterval);
        addEXP(10);
        playDing('pomodoro');
        chickLevelUp();
        addStudyTime(1);
        alert("ç•ªèŒ„é˜å®Œæˆï¼+10 EXP + 1å°æ™‚è®€æ›¸");
        timer=25*60; updateTimerDisplay();
        return;
      }
      timer--; updateTimerDisplay();
    },1000);
  }

  function resetTimer(){clearInterval(timerInterval); timer=25*60; updateTimerDisplay();}
  updateTimerDisplay();

  /* -------------------- Chart.js è®€æ›¸ç´€éŒ„ -------------------- */
  const studyData = localStorage.getItem("studyData")?JSON.parse(localStorage.getItem("studyData")):[0,0,0,0,0,0,0];
  const studyChart = new Chart(document.getElementById("studyChart"),{
    type:'line',
    data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"], datasets:[{label:"è®€æ›¸æ™‚é–“(å°æ™‚)",data:studyData,borderColor:"#ff8bb5",backgroundColor:"#ffbcd9",tension:0.3}]},
    options:{scales:{y:{beginAtZero:true}}}
  });
  function addStudyTime(hours){
    const day = new Date().getDay();
    const index = (day==0?6:day-1);
    studyData[index] += hours;
    localStorage.setItem("studyData", JSON.stringify(studyData));
    studyChart.data.datasets[0].data = studyData;
    studyChart.update();
    document.getElementById("todayTime").textContent = studyData[index]+" å°æ™‚";
    updateLeaderboard();
  }
  addStudyTime(0);

  /* -------------------- å°æ¸¬é©— -------------------- */
  const quizQuestions=[{q:"ä»Šå¤©ä½ å­¸ç¿’çš„å¿ƒæƒ…ï¼Ÿ", a:["å°ˆæ³¨","ç´¯","ç²¾ç¥"]},{q:"ä½ å–œæ­¡å“ªç¨®å°é›å¸½å­ï¼Ÿ", a:["çš‡å† ","æ³•å¸«å¸½","å†’éšªå¸½"]},{q:"å¦‚æœé‡åˆ°å›°é›£ï¼Œä½ æœƒï¼Ÿ", a:["åŠªåŠ›è§£æ±º","ä¼‘æ¯","æ‰¾æœ‹å‹"]},{q:"å­¸ç¿’ç’°å¢ƒä½ åå¥½ï¼Ÿ", a:["å®‰éœ","éŸ³æ¨‚","ç†±é¬§"]},{q:"ä½ è¦ºå¾—è‡ªå·±åƒå“ªéš»å°é›ï¼Ÿ", a:["å‘†èŒ","å‹‡æ•¢","èª¿çš®"]}];
  let quizIndex=0;
  function showQuiz(){
    const q=quizQuestions[quizIndex];
    document.getElementById("quizQuestion").textContent = q.q;
    const options = document.getElementById("quizOptions");
    options.innerHTML="";
    q.a.forEach(opt=>{
      const b=document.createElement("button");
      b.className="btn";
      b.textContent = opt;
      b.onclick = nextQuiz;
      options.appendChild(b);
    });
  }
  function nextQuiz(){quizIndex++; if(quizIndex<quizQuestions.length){showQuiz();} else{document.getElementById("quizResult").textContent="å°é›æ€§æ ¼å·²ç”Ÿæˆ ğŸ¥";}}
  showQuiz();

  /* -------------------- æ¨¡æ“¬ AI å°è€å¸« -------------------- */
  document.getElementById("sendAI").addEventListener("click", ()=>{
    const input=document.getElementById("chatInput").value.trim(); if(!input) return;
    const log=document.getElementById("chatLog");
    log.innerHTML+=`<div><b>ä½ ï¼š</b> ${input}</div>`;
    log.innerHTML+=`<div><b>AI å°è€å¸«ï¼š</b> é€™é¡Œä½ å¯ä»¥é€™æ¨£æƒ³ï¼šæŠŠå•é¡Œæ‹†å°ï¼Œä¸€æ­¥æ­¥è§£ï¼Œå°±æœƒæ›´æ¸…æ¥šå–”ï¼âœ¨</div>`;
    document.getElementById("chatInput").value="";
    log.scrollTop=log.scrollHeight;
  });

  /* -------------------- æ’è¡Œæ¦œ -------------------- */
  function updateLeaderboard(){
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard")||"[]");
    let existing = leaderboard.find(p=>p.name===playerName);
    if(existing){existing.level=level; existing.exp=exp;}
    else{leaderboard.push({name:playerName, level:level, exp:exp});}
    leaderboard.sort((a,b)=>b.level-b.level || b.exp-a.exp);
    localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
    const lbElem = document.getElementById("leaderboard");
    lbElem.innerHTML = "";
    leaderboard.slice(0,5).forEach((p,i)=>{
      lbElem.innerHTML += `<li>${i+1}. ${p.name} - Lv.${p.level} (${p.exp} EXP)</li>`;
    });
  }

  updateLevelUI();
  updateLeaderboard();

});
</script>
</body>
</html>
