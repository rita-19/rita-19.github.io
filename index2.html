<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Study Programï½œç‹è€…å®Œæ•´ç‰ˆ</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== å…¨åŸŸ ===== */
body{
  margin:0;
  font-family:"Microsoft JhengHei","å¾®è»Ÿæ­£é»‘é«”",sans-serif;
  font-size:18px;
  background:linear-gradient(#ffe6f7,#d6e8ff);
  text-align:center;
  transition:.3s;
}
body.dark{
  background:linear-gradient(160deg,#0f2027,#203a43,#2c5364);
  color:#eee;
}
.section{display:none}
.btn{
  padding:10px 16px;
  border:none;
  border-radius:14px;
  background:#ffb8d1;
  cursor:pointer;
  margin:5px;
}
body.dark .btn{
  background:#333;color:#fff;
}
.card{
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin:15px auto;
  width:300px;
}
body.dark .card{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
}

/* ===== å°é› ===== */
@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
  100%{transform:translateY(0)}
}
.chick{
  font-size:64px;
  animation:float 3s infinite;
}
body.dark .chick.brave{filter:drop-shadow(0 0 15px gold)}
body.dark .chick.calm{filter:drop-shadow(0 0 15px #7dd3fc)}
body.dark .chick.cute{filter:drop-shadow(0 0 15px pink)}
</style>
</head>

<body>

<h1>ğŸ¥ Study Program</h1>

<!-- å°è¦½ -->
<div>
  <button class="btn" onclick="UI.show('home')">é¦–é </button>
  <button class="btn" onclick="UI.show('pomodoro')">ç•ªèŒ„é˜</button>
  <button class="btn" onclick="UI.show('quiz')">å°æ¸¬é©—</button>
  <button class="btn" onclick="UI.show('chart')">åœ–è¡¨</button>
  <button class="btn" onclick="UI.show('rank')">æ’è¡Œæ¦œ</button>
  <button class="btn" onclick="UI.toggleDark()">ğŸŒ™</button>
</div>

<!-- ===== é¦–é  ===== -->
<section id="home" class="section" style="display:block">
  <div class="chick" id="chick">ğŸ¥</div>
  <div class="card">
    <p>ç­‰ç´šï¼š<span id="level">1</span></p>
    <p>EXPï¼š<span id="exp">0</span></p>
    <p>æ€§æ ¼ï¼š<span id="personality">å°šæœªæ¸¬é©—</span></p>
  </div>
</section>

<!-- ===== ç•ªèŒ„é˜ ===== -->
<section id="pomodoro" class="section">
  <h2>ğŸ… ç•ªèŒ„é˜</h2>
  <div id="timer" style="font-size:40px">25:00</div>
  <button class="btn" onclick="Pomodoro.start()">é–‹å§‹</button>
  <button class="btn" onclick="Pomodoro.pause()">æš«åœ</button>
  <button class="btn" onclick="Pomodoro.reset()">é‡è¨­</button>
</section>

<!-- ===== å°æ¸¬é©— ===== -->
<section id="quiz" class="section">
  <div class="card">
    <p id="quizQ"></p>
    <div id="quizOpt"></div>
  </div>
</section>

<!-- ===== åœ–è¡¨ ===== -->
<section id="chart" class="section">
  <canvas id="studyChart" width="300"></canvas>
</section>

<!-- ===== æ’è¡Œæ¦œ ===== -->
<section id="rank" class="section">
  <div class="card">
    <input id="nameInput" placeholder="è¼¸å…¥åç¨±">
    <button class="btn" onclick="Player.login()">ç™»å…¥</button>
    <p>åˆ†äº«ç¢¼ï¼š<b id="shareCode">-</b></p>
    <hr>
    <ul id="rankList"></ul>
  </div>
</section>

<script>
/* ===== ç‹€æ…‹ ===== */
const State={
  level:1,exp:0,
  personality:"",
  study:[0,0,0,0,0,0,0],
  players:{},
  current:null,
  dark:false
};

/* ===== UI ===== */
const UI={
  show(id){
    document.querySelectorAll('.section').forEach(s=>s.style.display='none');
    document.getElementById(id).style.display='block';
  },
  toggleDark(){
    State.dark=!State.dark;
    document.body.classList.toggle('dark',State.dark);
    save();
  },
  update(){
    level.textContent=State.level;
    exp.textContent=State.exp;
    personality.textContent=State.personality||"å°šæœªæ¸¬é©—";
    const c=document.getElementById('chick');
    c.className="chick";
    if(State.personality==="å‹‡æ•¢") c.classList.add("brave");
    if(State.personality==="å†·éœ") c.classList.add("calm");
    if(State.personality==="å‘†èŒ") c.classList.add("cute");
  }
};

/* ===== å‡ç´š ===== */
function addExp(n){
  State.exp+=n;
  if(State.exp>=State.level*50){
    State.exp-=State.level*50;
    State.level++;
    alert("â¬† å‡ç´šï¼");
  }
  UI.update(); save();
}

/* ===== ç•ªèŒ„é˜ ===== */
const Pomodoro={
  time:1500,timer:null,
  start(){
    if(this.timer) return;
    this.timer=setInterval(()=>{
      this.time--;
      if(this.time<=0){
        this.finish();
      }
      this.render();
    },1000);
  },
  pause(){clearInterval(this.timer);this.timer=null},
  reset(){this.pause();this.time=1500;this.render()},
  finish(){
    this.pause();
    addExp(25);
    State.study[new Date().getDay()||6]+=0.5;
    alert("ğŸ… å®Œæˆï¼");
    this.reset();
  },
  render(){
    timer.textContent=
      Math.floor(this.time/60)+":"+String(this.time%60).padStart(2,'0');
  }
};

/* ===== å°æ¸¬é©— ===== */
const Quiz={
  i:0,
  q:[
    ["ä½ åƒå“ªéš»å°é›ï¼Ÿ",["å‹‡æ•¢","å†·éœ","å‘†èŒ"]]
  ],
  show(){
    quizQ.textContent=this.q[this.i][0];
    quizOpt.innerHTML="";
    this.q[this.i][1].forEach(a=>{
      const b=document.createElement("button");
      b.className="btn";
      b.textContent=a;
      b.onclick=()=>{
        State.personality=a;
        addExp(30);
        UI.update();
        save();
        alert("æ¸¬é©—å®Œæˆï¼");
      };
      quizOpt.appendChild(b);
    });
  }
};
Quiz.show();

/* ===== ç©å®¶ / æ’è¡Œæ¦œ / åˆ†äº«ç¢¼ ===== */
const Player={
  login(){
    const n=nameInput.value.trim();
    if(!n) return;
    if(!State.players[n]){
      State.players[n]={level:1,code:Math.random().toString(36).slice(2,8)};
    }
    State.current=n;
    shareCode.textContent=State.players[n].code;
    this.updateRank();
    save();
  },
  updateRank(){
    rankList.innerHTML="";
    Object.entries(State.players)
      .sort((a,b)=>b[1].level-a[1].level)
      .forEach(([n,d])=>{
        const li=document.createElement("li");
        li.textContent=`${n}ï½œLv.${d.level}`;
        rankList.appendChild(li);
      });
  }
};

/* ===== åœ–è¡¨ ===== */
new Chart(document.getElementById("studyChart"),{
  type:"line",
  data:{labels:["ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","æ—¥"],
  datasets:[{data:State.study}]}
});

/* ===== å­˜æª” ===== */
function save(){
  localStorage.setItem("studyGame",JSON.stringify(State));
}
function load(){
  const d=localStorage.getItem("studyGame");
  if(d) Object.assign(State,JSON.parse(d));
  document.body.classList.toggle("dark",State.dark);
}
load(); UI.update();
</script>

</body>
</html>
